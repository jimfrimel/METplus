======================================================
Model Evaluation Tools Plus  (METplus)  (January 2017)
======================================================

Welcome to the documentation for METplus.  METplus is a set of Python wrapper scripts around the MET verification tools
(and eventually METViewer, a tool used for plotting MET output verification statistics).


================================================================================
Model Evaluation Tools Plus (METplus) TERMS OF USE - IMPORTANT!
================================================================================

USE OF THIS SOFTWARE IS SUBJECT TO THE FOLLOWING TERMS AND CONDITIONS:

1. License.  Subject to these terms and conditions, University Corporation for
   Atmospheric Research (UCAR) grants you a non-exclusive, royalty-free license
   to use, create derivative works, publish, distribute, disseminate, transfer,
   modify, revise and copy the Model Evaluation Tools Plus (MET plus) software.

   You shall not sell, license or transfer for a fee the Software, or any work
   that in any manner contains the Software.

2. Disclaimer of Warranty on Software.  Use of the Software is at your sole
   risk.  The Software is provided "AS IS" and without warranty of any kind and
   UCAR EXPRESSLY DISCLAIMS ALL WARRANTIES AND/OR CONDITIONS OF ANY KIND,
   EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, ANY WARRANTIES OR
   CONDITIONS OF TITLE, NON-INFRINGEMENT OF A THIRD PARTY'S INTELLECTUAL
   PROPERTY, MERCHANTABILITY OR SATISFACTORY QUALITY AND FITNESS FOR A
   PARTICULAR PURPOSE.  THE PARTIES EXPRESSLY DISCLAIM THAT THE UNIFORM COMPUTER
   INFORMATION TRANSACTIONS ACT (UCITA) APPLIES TO OR GOVERNS THIS AGREEMENT.
   No oral or written information or advice given by UCAR or a UCAR authorized
   representative shall create a warranty or in any way increase the scope of
   this warranty.  Should the Software prove defective, you (and neither UCAR
   nor any UCAR representative) assume the cost of all necessary correction.

3. Limitation of Liability.  UNDER NO CIRCUMSTANCES, INCLUDING NEGLIGENCE, SHALL
   UCAR BE LIABLE FOR ANY DIRECT, INCIDENTAL, SPECIAL, INDIRECT OR CONSEQUENTIAL
   DAMAGES INCLUDING LOST REVENUE, PROFIT OR DATA, WHETHER IN AN ACTION IN
   CONTRACT OR TORT ARISING OUT OF OR RELATING TO THE USE OF OR INABILITY TO USE
   THE SOFTWARE, EVEN IF UCAR HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH
   DAMAGES.

4. Compliance with Law.  All Software and any technical data delivered under
   this Agreement are subject to U.S. export control laws and may be subject to
   export or import regulations in other countries.  You agree to comply
   strictly with all applicable laws and regulations in connection with use and
   distribution of the Software, including export control laws, and you
   acknowledge that you have responsibility to obtain any required license to
   export, re-export, or import as may be required.

5. No Endorsement/No Support.  The names UCAR/NCAR, National Center for
   Atmospheric Research and the University Corporation for Atmospheric Research
   may not be used in any advertising or publicity to endorse or promote any
   products or commercial entity unless specific written permission is obtained
   from UCAR.  The Software is provided without any support or maintenance, and
   without any obligation to provide you with modifications, improvements,
   enhancements, or updates of the Software.

6. Controlling Law and Severability.  This Agreement shall be governed by the
   laws of the United States and the State of Colorado.  If for any reason a
   court of competent jurisdiction finds any provision, or portion thereof, to
   be unenforceable, the remainder of this Agreement shall continue in full
   force and effect.  This Agreement shall not be governed by the United Nations
   Convention on Contracts for the International Sale of Goods, the application
   of which is hereby expressly excluded.

7. Termination.  Your rights under this Agreement will terminate automatically
   without notice from UCAR if you fail to comply with any term(s) of this
   Agreement.  You may terminate this Agreement at any time by destroying the
   Software and any related documentation and any complete or partial copies
   thereof.  Upon termination, all rights granted under this Agreement shall
   terminate.  The following provisions shall survive termination: Sections 2, 3,
   6 and 9.

8. Complete Agreement.  This Agreement constitutes the entire agreement between
   the parties with respect to the use of the Software and supersedes all prior
   or contemporaneous understandings regarding such subject matter.  No
   amendment to or modification of this Agreement will be binding unless in
   writing and signed by UCAR.

9. Notices and Additional Terms.  Copyright in Software is held by UCAR. You
   must include, with each copy of the Software and associated documentation,
   a copy of this Agreement and the following notice:

   "The source of this material is the Research Applications Laboratory at the
   National Center for Atmospheric Research, a program of the University
   Corporation for Atmospheric Research (UCAR) pursuant to a Cooperative
   Agreement with the National Science Foundation; Copyright 2007 University
   Corporation for Atmospheric Research.  All Rights Reserved."

   The following notice shall be displayed on any scholarly works associated
   with, related to or derived from the Software:

   "Model Evaluation Tools Plus (METplus) was developed at the National Center 
    for Atmospheric Research (NCAR) through grants from the National Oceanic and 
    Atmospheric Administration (NOAA).  NCAR is sponsored by the United States 
    National Science Foundation (NSF)."

By using or downloading the Software, you agree to be bound by the terms and
conditions of this Agreement.


Background and Future
---------------------

METplus development began in 2016 with initial development for the cyclone-relative verification for the Stony Brook University (SBU) project.
Development in 2017 will focus on replicating the Global Deterministic National Centers for Environmental Prediction (NCEP) Verification and
future work will focus on ensemble, meso, and storm scale verification at NCEP and public support.


Dependencies
------------

The MET verification tools package is required to be installed on your system prior to running the METplus wrapper scripts.

METplus was developed using Python version 2.7.9.  Python version 2.7 or greater is required.

- METplus requires the following to be installed on your system:
  - ncdump utility
    - http://www.unidata.ucar.edu/downloads/netcdf/index.jsp
  - ncap2 utility
    - http://nco.sourceforge.net/
  - convert utility (part of ImageMagick)
    - https://www.imagemagick.org/script/binary-releases.php
  - wgrib2 utility
    - http://www.cpc.noaa.gov/products/wesley/wgrib2/compile_questions.html
  - egrep utility
    - http://directory.fsf.org/wiki/Grep
  - rm, cut, tr utilities (standard on Linux)


Version Control
---------------

METplus uses GIT for version control in a private NCAR repository.


Getting the Code and Test Data
------------------------------

Get the METplus package by running:

  wget http://www.dtcenter.org/met/users/downloads/METplus/METplus_alpha.20170308.tar

Get the METplus test data by running:

  wget http://www.dtcenter.org/met/users/downloads/METplus//METplus_test_data.20170109.tar.gz

Decide where you would like to put the code and copy the METplus Package to that location.  Unpack the gzipped tar file in that directory by running:

  tar -xf METplus_alpha.20170308.tar

Decide where you would like to put the test data and copy the METplus test data to that location.  Unpack the gzipped tar file in that directory by running:

  tar -zxf METplus_test_data.20170109.tar.gz


Configuring the Environment
---------------------------

Open up your .cshrc (or similar file) using the editor of your choice and add the following:

  To your PYTHONPATH, add:

    {full path to METplus/ush}:{full path to METplus/parm} (replacing the text in {} with the full path)

  If you do not currently have a PYTHONPATH, add (for csh shell - use "export" for bash):

    setenv PYTHONPATH {full path to METplus/ush}:{full path to METplus/parm} (replacing the text in {} with the full path)

  To your PATH (path), add:
    
    {full path to METplus/ush} (replacing the text in {} with the full path)

Save the changes and source your .cshrc (or similar file) by running, for example:

    source ~/.cshrc


Configuration Files
-------------------

There are two sets of configuration files - one for running METplus and one for running MET.

- METplus

The configuration file for METplus is constants_pdef.py, which is located in the "parm" subdirectory.

We are currently working on the ability for users to have their own version of the config file, where they would use
constants_pdef.py as the default config file, but would be able to override specific fields in their own config file.


- MET

The configuration files for the MET tools are also located in the "parm" subdirectory.  Currently, the applicable configuration files are
TCPairsETCConfig (for the extra tropical cyclone TCPairs run) and the SeriesAnalysisConfig_by_init and SeriesAnalysisConfig_by_lead.


Configuration Setup
-------------------

The user should look at the constants_pdef.py to modify necessary and desired fields.  The information below will cover the various sections:

NON-MET EXECUTABLES

Some of these fields may need to be modified based on the location of the executables on your system, but some may be standard. Note that
the WGRIB2 executable is not currently in a standard location and will need to be modified.


COMMONLY USED BASE VARIABLES

MET_BUILD_BASE is the base location for the MET release that you will be using. Please set that to an appropriate location.  

OUTPUT_BASE is the base area for where the user would like to store their output data.

PARM_BASE is the parm subdirectory for the METplus configuration files.   


MET EXECUTABLES

These fields rely on MET_BUILD_BASE and its "bin" subdirectory.  


INPUT DATA DIRECTORIES

These fields indicate where your input data is located.

For example, the METplus_test_data.20170109.tar.gz, includes a "reduced_model_data" directory, which contains GFS data, and a "track_data"
directory, which contains extra tropical cyclone track data.  If you wanted to put this data at "/d1/data/SBU", you would set the following:

PROJ_DIR = "/d1/data/SBU"
GFS_DIR = os.path.join(PROJ_DIR, "reduced_model_data")
TRACK_DATA_DIR = os.path.join(PROJ_DIR, "track_data")


OUTPUT DIRECTORIES

These fields include a log directory and a tmp directory along with other output directories. The TRACK_DATA_SUBDIR_MOD refers to the subdirectory
where the track data will be written, reformatted to be in true ATCF format, which the MET tools need for processing.


FILENAME TEMPLATES

These fields contain templates for filenames and filename prefixes and regular expressions.


CONFIGURATION FILES

These fields indicate which configuration files to use for MET.


LISTS AND SETTINGS

PROCESS_LIST is the list of processes that the user wants the master script to run.  For example, a full run from start to finish for running series
analysis by lead, would be:

 PROCESS_LIST = ["run_tc_pairs.py", "extract_tiles.py", "series_by_lead.py"]

STAT_LIST is the list of statistics to be computed (e.g. ["TOTAL", "FBAR", "OBAR"]).
NOTE: Currently, "TOTAL" is a REQUIRED cnt statistic used by the series analysis scripts, so it must be in the STAT_LIST.

INIT_DATE_BEG is the beginning date string in the format YYYYMMDD (e.g. "20141201") for the initialization time.
INIT_DATE_END is the ending date string in the format YYYYMMDD (e.g. "20150331") for the initialization time.
INIT_HOUR_INC is the hour increment in integer format (e.g. 6)
INIT_HOUR_END is the last increment hour you'd like to process in string format (e.g. For the sample data provided, GFS has 00, 06, 12, and 18, so this value would be "18")

VAR_LIST is the list of variables of interest with their levels (e.g. ["HGT/P500", "PRMSL/Z0", "TMP/Z2"])

EXTRACT_TILES_VAR_LIST is the list of variables of interest (for extraction) with their levels (e.g. ["HGT/P500", "PRMSL/Z0", "TMP/Z2"]).  Values should not be present in
both the VAR_LIST and the EXTRACT_TILES_VAR_LIST.

The following are used for performing series analysis based on lead time:
FHR_BEG is the beginning forecast time.  
FHR_END is the ending forecast time.
FHR_INC is the forecast hour increment.

NLAT and NLON are the dimensions of the tile.

DLAT and DLON is the resolution of the data in degrees.

LON_ADJ and LAT_ADJ are the degrees to subtract from the center lat and lon to calculate the lower left lat (lat_ll) and lower left lon (lon_ll) for a grid that is 2n X 2m, 
where n = LAT_ADJ degrees and m = LON_ADJ degrees.  For example, where n=15 and m=15, this results in a 30 deg X 30 deg grid.


TC PAIRS filtering options

This section contains the options used for the call to MET's tc_pairs code.


TC-STAT filtering options

This section contains the filtering options for the call to MET's tc_stat code.


OVERWRITE OPTIONS

These options exist so that you can choose whether or not to overwrite already processed data sets.


PLOTTING

This section contains the possible plotting options


REGRIDDING

This section contains the possible regridding options.  REGRID_USING_MET_TOOL is currently set to FALSE, as METplus is currently using wgrib2,
as opposed to regrid_data_plane, for part of its processing.


TESTING

These options are currently used by the developers and shouldn't need to be modified.


LOGGING

This section contains the logging options.  A LOG_LEVEL of "DEBUG" will likely provide too much information for the general user, so the user
may wish to start off with "INFO" instead.



How to Run?
-----------

Once you have set up constant_pdef.py you can simply run:

  master_met_plus.py



================================================================================
Release Notes
================================================================================

Alpha Release Notes:
-------------------
- Initial release of the code.
