<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>METplus: /home/mccabe/metplus-doc/METplus/ush/produtil/log.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">METplus
   &#160;<span id="projectnumber">METplusV3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_800bbfad623ff1c1bcbed02a018a6bda.html">ush</a></li><li class="navelem"><a class="el" href="dir_927812840bb05a9b23ea9540e8b05861.html">produtil</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">log.py</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html">    1</a></span>&#160;<span class="stringliteral">&quot;&quot;&quot;!Configures logging.</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="stringliteral">This module configures logging for stdout, stderr and the jlogfile.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="stringliteral">It also contains the jlogger, a logger.Logger object that is used to</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="stringliteral">log directly to the jlogfile, and jlogdomain: a string name of the </span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="stringliteral">logger domain for the jlogfile.&quot;&quot;&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">##@var __all__</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"># Symbols epxorted by &quot;from produtil.log import *&quot;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;__all__ = [ <span class="stringliteral">&#39;configureLogging&#39;</span>,<span class="stringliteral">&#39;jlogger&#39;</span>,<span class="stringliteral">&#39;jlogdomain&#39;</span>,<span class="stringliteral">&#39;postmsg&#39;</span>,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;            <span class="stringliteral">&#39;MasterLogFormatter&#39;</span>,<span class="stringliteral">&#39;JLogFormatter&#39;</span>,<span class="stringliteral">&#39;stdout_is_stderr&#39;</span>,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;            <span class="stringliteral">&#39;MasterLogHandler&#39;</span>,<span class="stringliteral">&#39;JLogHandler&#39;</span>,<span class="stringliteral">&#39;set_jlogfile&#39;</span> ]</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">import</span> logging, os, sys, traceback, threading</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">import</span> <a class="code" href="namespaceprodutil_1_1batchsystem.html">produtil.batchsystem</a></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">##@var logthread</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"># string for log messages to indicate thread number/name </span></div><div class="line"><a name="l00019"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#ae1ad0026aa892f5196366ae6b327fceb">   19</a></span>&#160;logthread=<span class="stringliteral">&#39;&#39;</span> </div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">##@var jlogdomain</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"># Logging domain for the jlogfile</span></div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#a8e5e8d625d7739349347798e87ae260e">   23</a></span>&#160;jlogdomain=<span class="stringliteral">&#39;jlog&#39;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">##@var jlogger</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"># A logging.Logger for the jlogdomain</span></div><div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#ae44de0fceb95843d0fc26caaffa0c113">   27</a></span>&#160;jlogger=logging.getLogger(jlogdomain)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">##@var jloghandler</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"># A logging.LogHandler for the jlogger</span></div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#a5539b917ecee21beec66e7b3f7609713">   31</a></span>&#160;jloghandler=<span class="keywordtype">None</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">##@var masterlogger</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"># Master log stream for MPI-split jobs.</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">#</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"># When a job is split via mpi_redirect, this logger will send data to</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"># the master log stream at lower log levels.  This is configurable via</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"># calls to mpi_redirect()</span></div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#a67daaa1f45619e51f98e5dfeeef62cb8">   39</a></span>&#160;masterlogger=<span class="keywordtype">None</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">##@var masterdomain</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"># Logging domain for the masterlogger</span></div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#aef02322fd546d396e5a5cf5b7f6fabf6">   43</a></span>&#160;masterdomain=<span class="keywordtype">None</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1ThreadLogger.html">   45</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1log_1_1ThreadLogger.html">ThreadLogger</a>(logging.Logger):</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Custom logging.Logger that inserts thread information.&quot;&quot;&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1ThreadLogger.html#ab5379ed780337d2086fac183d31146c2">   47</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1ThreadLogger.html#ab5379ed780337d2086fac183d31146c2">makeRecord</a>(self,name,lvl,fn,lno,msg,*args,**kwargs):</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Replaces the logging.Logger.makeRecord() with a new</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="stringliteral">        implementation that inserts thread information from</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="stringliteral">        threading.current_thread()</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="stringliteral">        @param name,lvl,fn,lno,msg,args,kwargs Log message information.</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="stringliteral">          See the Python logging module documentation for details.&quot;&quot;&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        ct=threading.current_thread()</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        msg=<span class="stringliteral">&#39;[%s] %s&#39;</span>%(str(ct.name),str(msg))</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        x=logging.Logger.makeRecord(self,name,lvl,fn,lno,msg,*args,**kwargs)</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="keywordflow">return</span> x</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#a8243e7f4b60ed0ac056ccec6c404107f">   58</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1log.html#a8243e7f4b60ed0ac056ccec6c404107f">postmsg</a>(message):</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Sends the message to the jlogfile logging stream at level INFO.</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral">    This is identical to:</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="stringliteral">    @code</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="stringliteral">       jlogger.info(message).</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="stringliteral">    @endcode</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="stringliteral">    @param message the message to log.&quot;&quot;&quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">return</span> jlogger.info(message)</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#ab2757a375c69b4821000732f848f45ae">   68</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1log.html#ab2757a375c69b4821000732f848f45ae">set_jlogfile</a>(filename):</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Tells the jlogger to log to the specified file instead of the</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="stringliteral">    current jlogfile.  Also updates the jlogfile environment variable.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="stringliteral">    The argument must be a filename.</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="stringliteral">    @param filename the new jlogfile&quot;&quot;&quot;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    jloghandler.set_jlogfile(filename)</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    os.environ[<span class="stringliteral">&#39;jlogfile&#39;</span>]=filename</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1MasterLogFormatter.html">   76</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html">MasterLogFormatter</a>(logging.Formatter): </div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This is a custom log formatter that inserts the thread or</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="stringliteral">    process (logthread) that generated the log message.  Also, it</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral">    always directly calls formatException from format, ensuring that</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral">    cached information is not used.  That allows a subclass</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="stringliteral">    (JLogFormatter) to ignore exceptions.&quot;&quot;&quot;</span> </div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1MasterLogFormatter.html#abbbe7153fd6cc4ba20a25fb251c56da0">   82</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html#abbbe7153fd6cc4ba20a25fb251c56da0">__init__</a>(self,fmt=None,datefmt=None,logthread=None): </div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!MasterLogFormatter constructor</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="stringliteral">        @param fmt the log message format</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="stringliteral">        @param datefmt the date format</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="stringliteral">        @param logthread the thread name for logging</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="stringliteral">        @note See the Python logging module documentation for details.&quot;&quot;&quot;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        logging.Formatter.__init__(self,fmt=fmt,datefmt=datefmt)</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        self.<a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html#a8476b9e1499c70aa39c9a2e3de73cc30">_logthread</a>=<span class="keywordtype">None</span> </div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    @property</div><div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1MasterLogFormatter.html#a8cbf2eb31eec4bfacd345c51f5c2ba1d">   91</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html#a8cbf2eb31eec4bfacd345c51f5c2ba1d">logthread</a>(self):</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!The name of the batch thread or process that generated log</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="stringliteral">        messages, if the LogRecord does not supply that already.&quot;&quot;&quot;</span> </div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keyword">global</span> logthread <span class="comment"># use global value if I don&#39;t have one </span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html#a8476b9e1499c70aa39c9a2e3de73cc30">_logthread</a> <span class="keywordflow">is</span> <span class="keywordtype">None</span>: <span class="keywordflow">return</span> logthread </div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html#a8476b9e1499c70aa39c9a2e3de73cc30">_logthread</a> </div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1MasterLogFormatter.html#adc4d347bb11fd62f4429ec599ae7a830">   97</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html#adc4d347bb11fd62f4429ec599ae7a830">format</a>(self, record):</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Replaces the logging.Formatter.format() function.</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="stringliteral">        We need to override this due to a &quot;feature&quot; in the</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="stringliteral">        Formatter.format: It ignores formatException (never calls it)</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="stringliteral">        and caches the exception info, even if the formatter is not</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="stringliteral">        supposed to output it.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="stringliteral">        @param record the log record to format</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="stringliteral">        @note See the Python logging module documentation for details.&quot;&quot;&quot;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keyword">global</span> logthread</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        record.message = record.getMessage()</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">if</span> self._fmt.find(<span class="stringliteral">&quot;%(asctime)&quot;</span>) &gt;= 0:</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            record.asctime = self.formatTime(record, self.datefmt)</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;logthread&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> record.__dict__:</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            record.__dict__[<span class="stringliteral">&#39;logthread&#39;</span>]=self.<a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html#a8cbf2eb31eec4bfacd345c51f5c2ba1d">logthread</a></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        s = self._fmt % record.__dict__</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;exc_info&#39;</span> <span class="keywordflow">in</span> record.__dict__ <span class="keywordflow">and</span> record.exc_info <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            e = self.<a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html#a264061008969ba175eb68d692648ef5d">formatException</a>(record.exc_info)</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="keywordflow">if</span> e:</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                rec2=dict(record.__dict__)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                <span class="keywordflow">for</span> line <span class="keywordflow">in</span> str(e).splitlines():</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                    rec2[<span class="stringliteral">&#39;message&#39;</span>]=line</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                    s=<span class="stringliteral">&quot;%s\n%s&quot;</span>%( s, self._fmt % rec2 )</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="keywordflow">return</span> s</div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1MasterLogFormatter.html#a264061008969ba175eb68d692648ef5d">  121</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html#a264061008969ba175eb68d692648ef5d">formatException</a>(self, ei):</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Returns nothing to indicate no exception information should</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="stringliteral">        be printed.</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="stringliteral">        @param ei the exception information to ignore&quot;&quot;&quot;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1JLogFormatter.html">  126</a></span>&#160;<span class="keyword">class </span>JLogFormatter(MasterLogFormatter):</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This subclass of MasterLogFormatter does not include exception</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="stringliteral">    information in the log file.  This is done to prevent cluttering</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="stringliteral">    of the log file.&quot;&quot;&quot;</span></div><div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1JLogFormatter.html#a3c96db8421efc29761a57a4fc222b40c">  130</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1JLogFormatter.html#a3c96db8421efc29761a57a4fc222b40c">formatException</a>(self, ei):</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Returns nothing to indicate no exception information should</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="stringliteral">        be printed.</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="stringliteral">        @param ei the exception information to ignore&quot;&quot;&quot;</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#a1f03c61b96ac09c398263cd5fad45bd0">  135</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1log.html#a1f03c61b96ac09c398263cd5fad45bd0">stdout_is_stderr</a>():</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Returns True if it can determine that stdout and stderr are the</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="stringliteral">    same file or terminal.  Returns False if it can determine they are</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="stringliteral">    not, or if the result is inconclusive.&quot;&quot;&quot;</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">if</span> os.fstat(sys.stdout.fileno()) == os.fstat(sys.stderr.fileno()):</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="keywordflow">if</span> sys.stdout.isatty() <span class="keywordflow">and</span> sys.stderr.isatty():</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">pass</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1MasterLogHandler.html">  148</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html">MasterLogHandler</a>(logging.Handler):</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Custom LogHandler for the master process of a multi-process job.</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="stringliteral">    This is a custom logging Handler class used for multi-process or</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral">    multi-job batch scripts.  It has a higher minimum log level for</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="stringliteral">    messages not sent to the jlogfile domain.  Also, for every log</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral">    message, the log file is opened, the message is written and the</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="stringliteral">    file is closed.  This is done to mimic the postmsg command.</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral">    Exception information is never sent to the log file.&quot;&quot;&quot;</span></div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1MasterLogHandler.html#a72b8f5c31094333d29a3bcb1715c2887">  157</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#a72b8f5c31094333d29a3bcb1715c2887">__init__</a>(self,logger,jlogdomain,otherlevels,joformat,jformat):</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!MasterLogHandler constructor</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">        @param logger The logging.Logger for the master process.</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="stringliteral">        @param jlogdomain The logging domain for the jlogfile.</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="stringliteral">        @param otherlevels Log level for any extrema to go to the jlogfile.</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="stringliteral">        @param joformat Log format for other streams.</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="stringliteral">        @param jformat Log format for the jlogfile stream.&quot;&quot;&quot;</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        logging.Handler.__init__(self)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#ac43ea0b8a4422801513171a261692795">_logger</a>=logger</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#ad28b6bd908e6754c681e7b3a8994db4d">_otherlevels</a>=otherlevels</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#a28640dcd47ced387e46b38ec9a769610">_jlogdomain</a>=jlogdomain</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#a4d99c66d724efc85982910e6893a6432">_joformat</a>=joformat</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#aa7cec090b1e4fd4279876606718868ac">_jformat</a>=jformat</div><div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1MasterLogHandler.html#a4037d9b8056462e20dc2ef94f5af0ba0">  170</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#a4037d9b8056462e20dc2ef94f5af0ba0">stringify_record</a>(self,record):</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Convert a log record to a string.</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="stringliteral">        @note See the Python logging module documentation for details.</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="stringliteral">        @returns a string message to print&quot;&quot;&quot;</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        assert(isinstance(self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#a4d99c66d724efc85982910e6893a6432">_joformat</a>,MasterLogFormatter))</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        assert(isinstance(self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#aa7cec090b1e4fd4279876606718868ac">_jformat</a>,MasterLogFormatter))</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keyword">global</span> logthread</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">if</span> record.name==self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#a28640dcd47ced387e46b38ec9a769610">_jlogdomain</a>:</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="comment"># Reformat for jlogdomain:</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            message=self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#aa7cec090b1e4fd4279876606718868ac">_jformat</a>.format(record)</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">elif</span> record.levelno&lt;self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#ad28b6bd908e6754c681e7b3a8994db4d">_otherlevels</a>:</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="keywordflow">return</span> <span class="keywordtype">None</span> <span class="comment"># log level too low</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            message=self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#a4d99c66d724efc85982910e6893a6432">_joformat</a>.format(record)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        message+=<span class="stringliteral">&#39;\n&#39;</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">return</span> message</div><div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1MasterLogHandler.html#ad2d057f4936c4121b157fdf77174db05">  186</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#ad2d057f4936c4121b157fdf77174db05">emit</a>(self,record):</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Write a log message.</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="stringliteral">        @param record the log record</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="stringliteral">        @note See the Python logging module documentation for details.&quot;&quot;&quot;</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        message=self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#a4037d9b8056462e20dc2ef94f5af0ba0">stringify_record</a>(record)</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">if</span> message <span class="keywordflow">is</span> <span class="keywordtype">None</span>: <span class="keywordflow">return</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#ac43ea0b8a4422801513171a261692795">_logger</a>.write(message)</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1JLogHandler.html">  194</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1log_1_1JLogHandler.html">JLogHandler</a>(<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html">MasterLogHandler</a>):</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Custom LogHandler for the jlogfile.</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="stringliteral">    This is a custom logging Handler class for the jlogfile.  It has a</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="stringliteral">    higher minimum log level for messages not sent to the jlogfile</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="stringliteral">    domain.  Also, for every log message, the log file is opened, the</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="stringliteral">    message is written and the file is closed.  This is done to mimic</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="stringliteral">    the postmsg command.  Exception information is never sent to the</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="stringliteral">    log file.&quot;&quot;&quot;</span></div><div class="line"><a name="l00203"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1JLogHandler.html#a86cdb28e1d7fa91ba47e4df49348a6e7">  203</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1JLogHandler.html#a86cdb28e1d7fa91ba47e4df49348a6e7">emit</a>(self,record):</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Write a log message.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="stringliteral">        @param record the log record</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="stringliteral">        @note See the Python logging module documentation for details.&quot;&quot;&quot;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        message=self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#a4037d9b8056462e20dc2ef94f5af0ba0">stringify_record</a>(record)</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">if</span> message <span class="keywordflow">is</span> <span class="keywordtype">None</span>: <span class="keywordflow">return</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">if</span> isinstance(self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#ac43ea0b8a4422801513171a261692795">_logger</a>,str):</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <span class="comment"># Open the file, write and close it, to mimic the postmsg script:</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            dirn=os.path.dirname(self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#ac43ea0b8a4422801513171a261692795">_logger</a>)</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isdir(dirn):</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                <span class="comment"># NOTE: Cannot use produtil.fileop.makedirs here due</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                <span class="comment"># to order of module loads (fileop needs log, so log</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                <span class="comment"># cannot need fileop):</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                <span class="keywordflow">for</span> x <span class="keywordflow">in</span> range(10):</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                        os.makedirs(dirn)</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                    <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                        <span class="keywordflow">if</span> os.path.isdir(dirn): </div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                            <span class="keywordflow">break</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                        <span class="keywordflow">elif</span> os.path.exists(dirn):</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                            <span class="keywordflow">raise</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                        <span class="keywordflow">elif</span> x&lt;9:</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                            <span class="keywordflow">continue</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                        <span class="keywordflow">raise</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            with open(self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#ac43ea0b8a4422801513171a261692795">_logger</a>,<span class="stringliteral">&#39;at&#39;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                f.write(message)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#ac43ea0b8a4422801513171a261692795">_logger</a>.write(message)</div><div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="classprodutil_1_1log_1_1JLogHandler.html#a5ffe8b6b441f2a57b84c8ae98bb5544e">  231</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1log_1_1JLogHandler.html#a5ffe8b6b441f2a57b84c8ae98bb5544e">set_jlogfile</a>(self, filename):</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Set the location of the jlogfile</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="stringliteral">        @param filename The path to the jlogfile.&quot;&quot;&quot;</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(filename,str):</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordflow">raise</span> TypeError(</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                <span class="stringliteral">&#39;In JLogHandler.set_jlogfile, the filename must be a &#39;</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                <span class="stringliteral">&#39;string.  You passed a %s %s.&#39;</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                %(type(filename).__name__,repr(filename)))</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        self.<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html#ac43ea0b8a4422801513171a261692795">_logger</a>=filename</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1log.html#a6ff20fdbdcfa72f6ce7cacf325418995">mpi_redirect</a>(threadname,stderrfile,stdoutfile,</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                 threadlevel=logging.WARNING,</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                 masterlevel=logging.INFO,</div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#a6ff20fdbdcfa72f6ce7cacf325418995">  244</a></span>&#160;                 openmode=None,logger=None):</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Used to split to multiple logging streams.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="stringliteral">    When the Python script splits itself into multiple processes via</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="stringliteral">    MPI, this function is called to redirect stdout to stdoutfile,</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="stringliteral">    stderr to stderrfile, and produce a new logging stream to the</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="stringliteral">    original stderr, with a logging level set to masterlevel.  That</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="stringliteral">    new logging stream is called the &quot;master log&quot; and will receive any</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="stringliteral">    messages at level masterlevel or higher, and any messages sent to</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="stringliteral">    the jlogdomain.</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="stringliteral">    This can also be used to redirect ONLY stdout, in which case no</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="stringliteral">    master logging stream is set up.  That is requested by</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="stringliteral">    stderrfile=None.</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="stringliteral">    @param threadname the name of this process for logging purposes</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="stringliteral">    @param stderrfile file to receive stderr</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="stringliteral">    @param stdoutfile file to receive stdout</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="stringliteral">    @param masterlevel log level to send to master log stream</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="stringliteral">    @param openmode integer mode to use when opening files</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="stringliteral">    @param logger a logging.Logger for logging errors while splitting</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="stringliteral">      the log stream.    &quot;&quot;&quot;</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordtype">None</span>: logger=logging.getLogger(<span class="stringliteral">&#39;produtil&#39;</span>)</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> openmode <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        openmode=os.O_CREAT|os.O_WRONLY|os.O_APPEND</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">elif</span> <span class="keywordflow">not</span> isinstance(openmode,int):</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">raise</span> TypeError(</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="stringliteral">&quot;In mpiRedirect, the openmode must be an int, not a &quot;</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            +type(openmode).__name__)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(stdoutfile,str):</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">raise</span> TypeError(</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <span class="stringliteral">&quot;In mpiRedirect, the stdoutfile must be a string, not a &quot;</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            +type(stdoutfile).__name__)</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> stderrfile <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> isinstance(stderrfile,str):</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordflow">raise</span> TypeError(</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="stringliteral">&quot;In mpiRedirect, the stderrfile must be a string or None, not a &quot;</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            +type(stderrfile).__name__)</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(threadname,str):</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">raise</span> TypeError(</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="stringliteral">&quot;In mpiRedirect, the threadname must be a string, not a &quot;</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            +type(threadname))</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keyword">global</span> logthread</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    logthread=<span class="stringliteral">&#39;[&#39;</span>+str(threadname)+<span class="stringliteral">&#39;]&#39;</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    logger.warning(<span class="stringliteral">&#39;Redirecting stdout to &quot;%s&quot; for thread %s&#39;</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                   %(stdoutfile,logthread))</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    fd=os.open(stdoutfile,openmode)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    os.dup2(fd,1)</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span> stderrfile <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        logger.warning(<span class="stringliteral">&#39;Redirecting stderr to &quot;%s&quot; for thread %s&#39;</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                       %(stderrfile,logthread))</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        olderrfd=os.dup(2)</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        olderr=os.fdopen(olderrfd,<span class="stringliteral">&#39;at&#39;</span>,0)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        if(stdoutfile!=stderrfile):</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="comment"># Only reopen if stderr differs from stdout.</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            fd=os.open(str(stderrfile),openmode)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        os.dup2(fd,2)</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    </div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        oformat=<a class="code" href="classprodutil_1_1log_1_1MasterLogFormatter.html">MasterLogFormatter</a>(</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="stringliteral">&quot;%(asctime)s.%(msecs)03d %(name)s %(logthread)s (%(filename)s:&quot;</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="stringliteral">&quot;%(lineno)d) %(levelname)s: %(message)s&quot;</span>,</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="stringliteral">&quot;%m/%d %H:%M:%S&quot;</span>)</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="comment"># Create the master log handler.  It will send to the old stderr</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="comment"># (from before the redirection), and send everything from</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="comment"># masterlevel and higher from any logging domain.  Anything sent</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="comment"># to the jlogfile, at any level, will be sent to the master log</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment"># file as well.</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        mloghandler=<a class="code" href="classprodutil_1_1log_1_1MasterLogHandler.html">MasterLogHandler</a>(olderr,masterdomain,threadlevel,oformat,</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                                     oformat)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        logger.warning(<span class="stringliteral">&#39;Turning on logging of high priority messages to &#39;</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                       <span class="stringliteral">&#39;original stderr stream.&#39;</span>)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">if</span> masterlevel!=logging.NOTSET:</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            mloghandler.setLevel(masterlevel)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordflow">raise</span> BaseException(<span class="stringliteral">&#39;no master level&#39;</span>)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        logging.getLogger().addHandler(mloghandler)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keyword">global</span> masterlogger</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    masterlogger=logging.getLogger(masterdomain)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="keyword">def </span>_set_master_domain(d):</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keyword">global</span> masterlogger, masterdomain</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    masterdomain=d</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    masterlogger=logging.getLogger(d)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    </div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1log.html#aedc25e6c768a6b86efa2a21c18976c38">configureLogging</a>(jlogfile=None,</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                     level=logging.INFO, <span class="comment"># all messages filtered by this</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                     jloglevel=logging.INFO,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                     japplevel=logging.ERROR, <span class="comment"># should be &gt;=jloglevel</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                     eloglevel=logging.WARNING,</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                     ologlevel=logging.NOTSET,</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                     thread_logger=False,</div><div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1log.html#aedc25e6c768a6b86efa2a21c18976c38">  339</a></span>&#160;                     masterdomain=&#39;master&#39;):</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Configures log output to stderr, stdout and the jlogfile</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="stringliteral">    Configures log file locations and logging levels for all streams.</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="stringliteral">    @note Important notes when choosing levels:</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="stringliteral">    * level - sets the global minimum log level.  Anything below this</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="stringliteral">          level will be discarded regardless of other settings.</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="stringliteral">    * jloglevel - this limit is applied before japplevel</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="stringliteral">    @param jlogfile path to the jlogfile. Default: use</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="stringliteral">            os.environ(&#39;jlogfile&#39;) if set.  Otherwise, stderr.</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="stringliteral">    @param level minimum logging level globally.  Set to INFO by default.</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="stringliteral">            Change this to logging.DEBUG if you&#39;re debugging the program.</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="stringliteral">    @param jloglevel minimum logging level to send to jlogfile</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="stringliteral">    @param japplevel minimum logging level to send to jlogfile from all</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="stringliteral">            domains except that specified in jlogdomain.  Be careful</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="stringliteral">            when changing this as it logs directly to the WCOSS-wide</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="stringliteral">            jlogfile in operations.</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="stringliteral">    @param eloglevel minimum logging level to send to stderr from ALL logs</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="stringliteral">            Set to None to disable stderr logging</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="stringliteral">    @param ologlevel minimum logging level to send to stdout from ALL logs</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="stringliteral">            Default: logging.NOTSET (no filtering)</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="stringliteral">            Set to None to disable stdout logging.</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="stringliteral">    @param thread_logger True to include the thread name in log messages.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="stringliteral">    @param masterdomain The logging domain that will send messages to the</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="stringliteral">            main log stream for the job, even within individual ranks of</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="stringliteral">            mpi-split jobs&quot;&quot;&quot;</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keyword">global</span> jloghandler</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">if</span> thread_logger:</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        logging.setLoggerClass(<a class="code" href="classprodutil_1_1log_1_1ThreadLogger.html">produtil.log.ThreadLogger</a>)</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    _set_master_domain(masterdomain)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    </div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    root=logging.getLogger()</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <span class="keywordflow">if</span> level!=logging.NOTSET:</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        root.setLevel(level) <span class="comment"># set global minimum logging level</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment"># Configure log formatting:</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    jlog=logging.getLogger(<span class="stringliteral">&#39;jlogfile&#39;</span>)</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    jobstr=os.environ.get(<span class="stringliteral">&#39;job&#39;</span>,<span class="keywordtype">None</span>)</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> jobstr <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        jobstr=<a class="code" href="namespaceprodutil_1_1batchsystem.html#ad05f61e75d25821ddb6653772336e7e5">produtil.batchsystem.jobname</a>()</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    jobstr=str(jobstr).replace(<span class="stringliteral">&#39;(&#39;</span>,<span class="stringliteral">&#39;_&#39;</span>).replace(<span class="stringliteral">&#39;)&#39;</span>,<span class="stringliteral">&#39;_&#39;</span>).replace(<span class="stringliteral">&#39;%&#39;</span>,<span class="stringliteral">&#39;_&#39;</span>)</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="comment"># Format for jlogfile domain logging to jlogfile:</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    jformat=<a class="code" href="classprodutil_1_1log_1_1JLogFormatter.html">JLogFormatter</a>(</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="stringliteral">&quot;%(asctime)sZ &quot;</span>+jobstr+<span class="stringliteral">&quot;-%(levelname)s: %(logthread)s %(message)s&quot;</span>,</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="stringliteral">&quot;%m/%d %H:%M:%S&quot;</span>)</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="comment"># Format for other domains logging to jlogfile is the same, but</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment"># with the domain added:</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    joformat=<a class="code" href="classprodutil_1_1log_1_1JLogFormatter.html">JLogFormatter</a>(</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="stringliteral">&quot;%(asctime)sZ &quot;</span>+jobstr+</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="stringliteral">&quot;-%(name)s: %(levelname)s: %(logthread)s %(message)s&quot;</span>,</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="stringliteral">&quot;%m/%d %H:%M:%S&quot;</span>)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment"># For stdout/stderr, a more verbose version with milliseconds,</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="comment"># file and line numbers:</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    oformat=logging.Formatter(</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="stringliteral">&quot;%(asctime)s.%(msecs)03d %(name)s (%(filename)s:%(lineno)d) &quot;</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="stringliteral">&quot;%(levelname)s: %(message)s&quot;</span>,</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="stringliteral">&quot;%m/%d %H:%M:%S&quot;</span>)</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> <a class="code" href="namespaceprodutil_1_1log.html#a1f03c61b96ac09c398263cd5fad45bd0">stdout_is_stderr</a>():</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="comment"># Configure combined stdout+stderr logging:</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        loglevel=min(ologlevel,eloglevel)</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        logstream=logging.StreamHandler(sys.stderr)</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        logstream.setFormatter(oformat)</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">if</span> loglevel!=logging.NOTSET: logstream.setLevel(loglevel)</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        root.addHandler(logstream)</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="comment"># Configure stdout logging:</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">if</span> ologlevel <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            ologstream=logging.StreamHandler(sys.stdout)</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            ologstream.setFormatter(oformat)</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <span class="keywordflow">if</span> ologlevel!=logging.NOTSET: ologstream.setLevel(ologlevel)</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            root.addHandler(ologstream)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="comment"># Configure stderr logging:</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">if</span> eloglevel <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            elogstream=logging.StreamHandler(sys.stderr)</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            elogstream.setFormatter(oformat) <span class="comment"># same format as stdout</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <span class="keywordflow">if</span> eloglevel!=logging.NOTSET: elogstream.setLevel(eloglevel)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            root.addHandler(elogstream)</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment"># Configure jlogfile logging:</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="comment">#   jlogfile domain: INFO and higher</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">#   all domains: ERROR and higher</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordflow">if</span> jlogfile <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="comment"># Try to get the jlogfile from the environment if none is specified:</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        var=str(os.environ.get(<span class="stringliteral">&#39;jlogfile&#39;</span>,<span class="stringliteral">&#39;&#39;</span>))</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">if</span> len(var)&gt;0: jlogfile=var</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment"># If we still don&#39;t have the jlogfile, use stderr:</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    jlogfile=str(jlogfile) <span class="keywordflow">if</span> jlogfile <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> sys.stderr</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    jloghandler=<a class="code" href="classprodutil_1_1log_1_1JLogHandler.html">JLogHandler</a>(jlogfile,jlogdomain,japplevel,joformat,jformat)</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">if</span> jloglevel!=logging.NOTSET: jloghandler.setLevel(jloglevel)</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    root.addHandler(jloghandler)</div><div class="ttc" id="classprodutil_1_1log_1_1JLogHandler_html_a5ffe8b6b441f2a57b84c8ae98bb5544e"><div class="ttname"><a href="classprodutil_1_1log_1_1JLogHandler.html#a5ffe8b6b441f2a57b84c8ae98bb5544e">produtil.log.JLogHandler.set_jlogfile</a></div><div class="ttdeci">def set_jlogfile(self, filename)</div><div class="ttdoc">Set the location of the jlogfile. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00231">log.py:231</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1log_html_ab2757a375c69b4821000732f848f45ae"><div class="ttname"><a href="namespaceprodutil_1_1log.html#ab2757a375c69b4821000732f848f45ae">produtil.log.set_jlogfile</a></div><div class="ttdeci">def set_jlogfile(filename)</div><div class="ttdoc">Tells the jlogger to log to the specified file instead of the current jlogfile. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00068">log.py:68</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1log_html_aedc25e6c768a6b86efa2a21c18976c38"><div class="ttname"><a href="namespaceprodutil_1_1log.html#aedc25e6c768a6b86efa2a21c18976c38">produtil.log.configureLogging</a></div><div class="ttdeci">def configureLogging(jlogfile=None, level=logging.INFO, jloglevel=logging.INFO, japplevel=logging.ERROR, eloglevel=logging.WARNING, ologlevel=logging.NOTSET, thread_logger=False, masterdomain='master')</div><div class="ttdoc">Configures log output to stderr, stdout and the jlogfile. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00339">log.py:339</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogHandler_html_a4037d9b8056462e20dc2ef94f5af0ba0"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogHandler.html#a4037d9b8056462e20dc2ef94f5af0ba0">produtil.log.MasterLogHandler.stringify_record</a></div><div class="ttdeci">def stringify_record(self, record)</div><div class="ttdoc">Convert a log record to a string. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00170">log.py:170</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogHandler_html_a4d99c66d724efc85982910e6893a6432"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogHandler.html#a4d99c66d724efc85982910e6893a6432">produtil.log.MasterLogHandler._joformat</a></div><div class="ttdeci">_joformat</div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00168">log.py:168</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1JLogFormatter_html"><div class="ttname"><a href="classprodutil_1_1log_1_1JLogFormatter.html">produtil.log.JLogFormatter</a></div><div class="ttdoc">This subclass of MasterLogFormatter does not include exception information in the log file...</div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00126">log.py:126</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogHandler_html_a72b8f5c31094333d29a3bcb1715c2887"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogHandler.html#a72b8f5c31094333d29a3bcb1715c2887">produtil.log.MasterLogHandler.__init__</a></div><div class="ttdeci">def __init__(self, logger, jlogdomain, otherlevels, joformat, jformat)</div><div class="ttdoc">Custom LogHandler for the master process of a multi-process job. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00157">log.py:157</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogFormatter_html_a8476b9e1499c70aa39c9a2e3de73cc30"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogFormatter.html#a8476b9e1499c70aa39c9a2e3de73cc30">produtil.log.MasterLogFormatter._logthread</a></div><div class="ttdeci">_logthread</div><div class="ttdoc">MasterLogFormatter constructor. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00089">log.py:89</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1log_html_a8243e7f4b60ed0ac056ccec6c404107f"><div class="ttname"><a href="namespaceprodutil_1_1log.html#a8243e7f4b60ed0ac056ccec6c404107f">produtil.log.postmsg</a></div><div class="ttdeci">def postmsg(message)</div><div class="ttdoc">Sends the message to the jlogfile logging stream at level INFO. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00058">log.py:58</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogHandler_html_a28640dcd47ced387e46b38ec9a769610"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogHandler.html#a28640dcd47ced387e46b38ec9a769610">produtil.log.MasterLogHandler._jlogdomain</a></div><div class="ttdeci">_jlogdomain</div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00167">log.py:167</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogFormatter_html_abbbe7153fd6cc4ba20a25fb251c56da0"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogFormatter.html#abbbe7153fd6cc4ba20a25fb251c56da0">produtil.log.MasterLogFormatter.__init__</a></div><div class="ttdeci">def __init__(self, fmt=None, datefmt=None, logthread=None)</div><div class="ttdoc">MasterLogFormatter constructor. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00082">log.py:82</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogHandler_html_ad28b6bd908e6754c681e7b3a8994db4d"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogHandler.html#ad28b6bd908e6754c681e7b3a8994db4d">produtil.log.MasterLogHandler._otherlevels</a></div><div class="ttdeci">_otherlevels</div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00166">log.py:166</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogFormatter_html_a8cbf2eb31eec4bfacd345c51f5c2ba1d"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogFormatter.html#a8cbf2eb31eec4bfacd345c51f5c2ba1d">produtil.log.MasterLogFormatter.logthread</a></div><div class="ttdeci">def logthread(self)</div><div class="ttdoc">The name of the batch thread or process that generated log messages, if the LogRecord does not supply...</div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00091">log.py:91</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1log_html_a6ff20fdbdcfa72f6ce7cacf325418995"><div class="ttname"><a href="namespaceprodutil_1_1log.html#a6ff20fdbdcfa72f6ce7cacf325418995">produtil.log.mpi_redirect</a></div><div class="ttdeci">def mpi_redirect(threadname, stderrfile, stdoutfile, threadlevel=logging.WARNING, masterlevel=logging.INFO, openmode=None, logger=None)</div><div class="ttdoc">Used to split to multiple logging streams. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00244">log.py:244</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogFormatter_html"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogFormatter.html">produtil.log.MasterLogFormatter</a></div><div class="ttdoc">This is a custom log formatter that inserts the thread or process (logthread) that generated the log ...</div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00076">log.py:76</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1log_html_a1f03c61b96ac09c398263cd5fad45bd0"><div class="ttname"><a href="namespaceprodutil_1_1log.html#a1f03c61b96ac09c398263cd5fad45bd0">produtil.log.stdout_is_stderr</a></div><div class="ttdeci">def stdout_is_stderr()</div><div class="ttdoc">Returns True if it can determine that stdout and stderr are the same file or terminal. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00135">log.py:135</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogHandler_html_aa7cec090b1e4fd4279876606718868ac"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogHandler.html#aa7cec090b1e4fd4279876606718868ac">produtil.log.MasterLogHandler._jformat</a></div><div class="ttdeci">_jformat</div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00169">log.py:169</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogHandler_html_ad2d057f4936c4121b157fdf77174db05"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogHandler.html#ad2d057f4936c4121b157fdf77174db05">produtil.log.MasterLogHandler.emit</a></div><div class="ttdeci">def emit(self, record)</div><div class="ttdoc">Write a log message. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00186">log.py:186</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogHandler_html_ac43ea0b8a4422801513171a261692795"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogHandler.html#ac43ea0b8a4422801513171a261692795">produtil.log.MasterLogHandler._logger</a></div><div class="ttdeci">_logger</div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00165">log.py:165</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1batchsystem_html"><div class="ttname"><a href="namespaceprodutil_1_1batchsystem.html">produtil.batchsystem</a></div><div class="ttdoc">Provides information about the batch system. </div><div class="ttdef"><b>Definition:</b> <a href="batchsystem_8py_source.html#l00001">batchsystem.py:1</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1ThreadLogger_html_ab5379ed780337d2086fac183d31146c2"><div class="ttname"><a href="classprodutil_1_1log_1_1ThreadLogger.html#ab5379ed780337d2086fac183d31146c2">produtil.log.ThreadLogger.makeRecord</a></div><div class="ttdeci">def makeRecord(self, name, lvl, fn, lno, msg, args, kwargs)</div><div class="ttdoc">Replaces the logging.Logger.makeRecord() with a new implementation that inserts thread information fr...</div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00047">log.py:47</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1JLogFormatter_html_a3c96db8421efc29761a57a4fc222b40c"><div class="ttname"><a href="classprodutil_1_1log_1_1JLogFormatter.html#a3c96db8421efc29761a57a4fc222b40c">produtil.log.JLogFormatter.formatException</a></div><div class="ttdeci">def formatException(self, ei)</div><div class="ttdoc">This subclass of MasterLogFormatter does not include exception information in the log file...</div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00130">log.py:130</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogHandler_html"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogHandler.html">produtil.log.MasterLogHandler</a></div><div class="ttdoc">Custom LogHandler for the master process of a multi-process job. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00148">log.py:148</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1batchsystem_html_ad05f61e75d25821ddb6653772336e7e5"><div class="ttname"><a href="namespaceprodutil_1_1batchsystem.html#ad05f61e75d25821ddb6653772336e7e5">produtil.batchsystem.jobname</a></div><div class="ttdeci">def jobname(fallback=UNSPECIFIED)</div><div class="ttdoc">Get the batch job name. </div><div class="ttdef"><b>Definition:</b> <a href="batchsystem_8py_source.html#l00084">batchsystem.py:84</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogFormatter_html_adc4d347bb11fd62f4429ec599ae7a830"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogFormatter.html#adc4d347bb11fd62f4429ec599ae7a830">produtil.log.MasterLogFormatter.format</a></div><div class="ttdeci">def format(self, record)</div><div class="ttdoc">Replaces the logging.Formatter.format() function. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00097">log.py:97</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1JLogHandler_html"><div class="ttname"><a href="classprodutil_1_1log_1_1JLogHandler.html">produtil.log.JLogHandler</a></div><div class="ttdoc">Custom LogHandler for the jlogfile. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00194">log.py:194</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1MasterLogFormatter_html_a264061008969ba175eb68d692648ef5d"><div class="ttname"><a href="classprodutil_1_1log_1_1MasterLogFormatter.html#a264061008969ba175eb68d692648ef5d">produtil.log.MasterLogFormatter.formatException</a></div><div class="ttdeci">def formatException(self, ei)</div><div class="ttdoc">Returns nothing to indicate no exception information should be printed. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00121">log.py:121</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1JLogHandler_html_a86cdb28e1d7fa91ba47e4df49348a6e7"><div class="ttname"><a href="classprodutil_1_1log_1_1JLogHandler.html#a86cdb28e1d7fa91ba47e4df49348a6e7">produtil.log.JLogHandler.emit</a></div><div class="ttdeci">def emit(self, record)</div><div class="ttdoc">Write a log message. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00203">log.py:203</a></div></div>
<div class="ttc" id="classprodutil_1_1log_1_1ThreadLogger_html"><div class="ttname"><a href="classprodutil_1_1log_1_1ThreadLogger.html">produtil.log.ThreadLogger</a></div><div class="ttdoc">Custom logging.Logger that inserts thread information. </div><div class="ttdef"><b>Definition:</b> <a href="log_8py_source.html#l00045">log.py:45</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
