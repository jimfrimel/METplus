<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>METplus: /home/mccabe/metplus-doc/METplus/ush/produtil/fileop.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">METplus
   &#160;<span id="projectnumber">METplusV3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_800bbfad623ff1c1bcbed02a018a6bda.html">ush</a></li><li class="navelem"><a class="el" href="dir_927812840bb05a9b23ea9540e8b05861.html">produtil</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">fileop.py</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html">    1</a></span>&#160;<span class="stringliteral">&quot;&quot;&quot;!This module provides a set of utility functions to do filesystem</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="stringliteral">operations.  It replaces or improves upon several os, stat, and sys</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="stringliteral">module functions by working around Python bugs, providing an API layer</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="stringliteral">that allows forward compatibility to future Python versions, and</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="stringliteral">adding logging capabilities.&quot;&quot;&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">##@var __all__</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"># List of symbols exported by &quot;from produtil.fileop import *&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;__all__=[<span class="stringliteral">&#39;FileOpError&#39;</span>,<span class="stringliteral">&#39;FileOpErrors&#39;</span>,<span class="stringliteral">&#39;CannotLinkMulti&#39;</span>,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;         <span class="stringliteral">&#39;UnexpectedAbsolutePath&#39;</span>,<span class="stringliteral">&#39;InvalidExecutable&#39;</span>,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;         <span class="stringliteral">&#39;FindExeInvalidExeName&#39;</span>,<span class="stringliteral">&#39;CannotFindExe&#39;</span>,<span class="stringliteral">&#39;RelativePathError&#39;</span>,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;         <span class="stringliteral">&#39;DeliveryFailed&#39;</span>,<span class="stringliteral">&#39;VerificationFailed&#39;</span>,<span class="stringliteral">&#39;realcwd&#39;</span>,<span class="stringliteral">&#39;chdir&#39;</span>,</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;         <span class="stringliteral">&#39;makedirs&#39;</span>,<span class="stringliteral">&#39;remove_file&#39;</span>,<span class="stringliteral">&#39;rmall&#39;</span>,<span class="stringliteral">&#39;lstat_stat&#39;</span>,<span class="stringliteral">&#39;isnonempty&#39;</span>,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;         <span class="stringliteral">&#39;check_file&#39;</span>,<span class="stringliteral">&#39;deliver_file&#39;</span>,<span class="stringliteral">&#39;make_symlinks_in&#39;</span>,<span class="stringliteral">&#39;find_exe&#39;</span>,</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;         <span class="stringliteral">&#39;make_symlink&#39;</span>,<span class="stringliteral">&#39;replace_symlink&#39;</span>,<span class="stringliteral">&#39;unblock&#39;</span>,<span class="stringliteral">&#39;fortcopy&#39;</span>,</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;         <span class="stringliteral">&#39;norm_expand_path&#39;</span>,<span class="stringliteral">&#39;norm_abs_path&#39;</span>,<span class="stringliteral">&#39;check_last_lines&#39;</span>,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;         <span class="stringliteral">&#39;wait_for_files&#39;</span>,<span class="stringliteral">&#39;FileWaiter&#39;</span>,<span class="stringliteral">&#39;call_fcntrl&#39;</span>,<span class="stringliteral">&#39;gribver&#39;</span>,</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;         <span class="stringliteral">&#39;netcdfver&#39;</span>,<span class="stringliteral">&#39;touch&#39;</span>]</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">import</span> os,tempfile,filecmp,stat,shutil,errno,random,time,fcntl,math,logging</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">import</span> <a class="code" href="namespaceprodutil_1_1cluster.html">produtil.cluster</a>, <a class="code" href="namespaceprodutil_1_1pipeline.html">produtil.pipeline</a></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;module_logger=logging.getLogger(<span class="stringliteral">&#39;produtil.fileop&#39;</span>)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileOpError.html">   26</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html">FileOpError</a>(Exception):</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This is the superclass of several exceptions relating to</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="stringliteral">    multi-file operations in produtil.fileop.&quot;&quot;&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileOpError.html#a63a850fb46a0a9fcfdb095726ff244fa">   29</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html#a63a850fb46a0a9fcfdb095726ff244fa">__init__</a>(self,message,filename,more=[]):</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!FileOpError constructor</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="stringliteral">        @param message the error message</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">        @param filename the name of the problematic file</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="stringliteral">        @param more a list of tuples, (from,to,message) where from is</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="stringliteral">          the source file, to is the destination file and message is a</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="stringliteral">          description of the problem with that pair.&quot;&quot;&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileOpError.html#aef86d7687a32ff0310e2a1dd4529eb82">   36</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html#aef86d7687a32ff0310e2a1dd4529eb82">message</a>=message</div><div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileOpError.html#a948b57d6ba76e2a11506d93c1b574999">   37</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html#a948b57d6ba76e2a11506d93c1b574999">filename</a>=filename</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileOpError.html#a3047a635cbdec034ac5c7d5048af5899">   38</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html#a3047a635cbdec034ac5c7d5048af5899">more</a>=more</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">##@var message</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">    # The error message</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">##@var filename</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">    # The name of the problematic file</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">##@var more</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">    # A list of tuples, (from,to,message) where from is the</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">    # source file, to is the destination file and message is a</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">    # description of the problem with that pair.</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileOpError.html#a18cf7a0178abf6e6cdd4116ad0e87e83">   50</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html#a18cf7a0178abf6e6cdd4116ad0e87e83">__str__</a>(self):</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!A string description of the problem.&quot;&quot;&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;%s: %s&#39;</span> % (self.<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html#a948b57d6ba76e2a11506d93c1b574999">filename</a>,self.<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html#aef86d7687a32ff0310e2a1dd4529eb82">message</a>)</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileOpError.html#ab65372c3f15d2df0dbce8c3bbbdbe3f2">   53</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html#ab65372c3f15d2df0dbce8c3bbbdbe3f2">__iter__</a>(self):</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Iterates over a list of tuples, (from,to,message) where</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="stringliteral">        from is the source file, to is the destination file and</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="stringliteral">        message is a description of the problem with that pair.&quot;&quot;&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="keywordflow">for</span> fromfile,tofile,message <span class="keywordflow">in</span> self.<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html#a3047a635cbdec034ac5c7d5048af5899">more</a>:</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            <span class="keywordflow">yield</span> fromfile,tofile,message</div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileOpErrors.html">   59</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1FileOpErrors.html">FileOpErrors</a>(<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html">FileOpError</a>):</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This exception is raised when an operation that processes</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral">    multiple files catches more than one exception.&quot;&quot;&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1CannotLinkMulti.html">   62</a></span>&#160;<span class="keyword">class </span>CannotLinkMulti(FileOpError):</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This exception is raised when the caller tries to create</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="stringliteral">    multiple symlinks in a single target, but the target is not a</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="stringliteral">    directory.&quot;&quot;&quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1UnexpectedAbsolutePath.html">   66</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1UnexpectedAbsolutePath.html">UnexpectedAbsolutePath</a>(<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html">FileOpError</a>):</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This exception indicates that the renamer function sent to</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="stringliteral">    make_symlinks_in returned an absolute path.&quot;&quot;&quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1InvalidExecutable.html">   69</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1InvalidExecutable.html">InvalidExecutable</a>(<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html">FileOpError</a>):</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Thrown when a find_exe fails.&quot;&quot;&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FindExeInvalidExeName.html">   71</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1FindExeInvalidExeName.html">FindExeInvalidExeName</a>(<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html">FileOpError</a>):</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Thrown when find_exe is given an executable name that contains</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="stringliteral">    a directory path.&quot;&quot;&quot;</span></div><div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1CannotFindExe.html">   74</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1CannotFindExe.html">CannotFindExe</a>(<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html">FileOpError</a>):</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Thrown when find_exe cannot find an executable in the path or</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="stringliteral">    directory list.&quot;&quot;&quot;</span></div><div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1RelativePathError.html">   77</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1RelativePathError.html">RelativePathError</a>(<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html">FileOpError</a>):</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Raised when a relative path is given, but an absolute path is</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral">    expected.&quot;&quot;&quot;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1WrongSymlink.html">   81</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1WrongSymlink.html">WrongSymlink</a>(<a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html">FileOpError</a>):</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Raised when os.symlink makes a symlink to a target other than</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="stringliteral">    the one that was requested.  This is present to detect a bug in</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="stringliteral">    Cray where os.symlink randomly makes a symlink to the wrong</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="stringliteral">    place.&quot;&quot;&quot;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1DeliveryFailed.html">   87</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html">DeliveryFailed</a>(Exception):</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This exception is raised when a file cannot be delivered.&quot;&quot;&quot;</span></div><div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#aa116bcb469841c7730a2c192c5105338">   89</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#aa116bcb469841c7730a2c192c5105338">__init__</a>(self,message,fromfile,tofile):</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!DeliveryFailed constructor.</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="stringliteral">        @param message why the delivery failed</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="stringliteral">        @param fromfile what was being delivered</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="stringliteral">        @param tofile delivery destination&quot;&quot;&quot;</span></div><div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a5d547c2c860f6031087f47fed33fa0c3">   94</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a5d547c2c860f6031087f47fed33fa0c3">message</a>=message</div><div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a50fea4b7bb0919d0c0a4e91cf94ae583">   95</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a50fea4b7bb0919d0c0a4e91cf94ae583">fromfile</a>=fromfile</div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#aada16d988676d50769c3e0dd94206d24">   96</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#aada16d988676d50769c3e0dd94206d24">tofile</a>=tofile</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">##@var message</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">    # String description of the problem</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">##@var fromfile</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">    # The source file</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">##@var tofile</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">    # The target file </span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a0190de016de397b3f077c4c99b160d77">  106</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a0190de016de397b3f077c4c99b160d77">__str__</a>(self):</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Human-readable description of this error.&quot;&quot;&quot;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;%s: cannot deliver (from %s): %s&#39;</span>%(</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#aada16d988676d50769c3e0dd94206d24">tofile</a>,self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a50fea4b7bb0919d0c0a4e91cf94ae583">fromfile</a>,self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a5d547c2c860f6031087f47fed33fa0c3">message</a>)</div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a5f2b48e2f2f95216a243c5d15d13d627">  110</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a5f2b48e2f2f95216a243c5d15d13d627">__repr__</a>(self):</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Pythonic representation of this error.&quot;&quot;&quot;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;DeliveryFailed(%s,%s,%s)&#39;</span> %  \</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            (repr(self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a5d547c2c860f6031087f47fed33fa0c3">message</a>),repr(self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a50fea4b7bb0919d0c0a4e91cf94ae583">fromfile</a>),repr(self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#aada16d988676d50769c3e0dd94206d24">tofile</a>))</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1VerificationFailed.html">  115</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1VerificationFailed.html">VerificationFailed</a>(<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html">DeliveryFailed</a>):</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This exception is raised when a copy of a file has different</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="stringliteral">    content than the original.&quot;&quot;&quot;</span></div><div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1VerificationFailed.html#ab3a0b9e1bafa03f9721b027f61f24ee9">  118</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1VerificationFailed.html#ab3a0b9e1bafa03f9721b027f61f24ee9">__init__</a>(self,message,fromfile,tofile,verifyfile):</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!VerificationFailed constructor.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="stringliteral">        @param message why the delivery failed</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="stringliteral">        @param fromfile what was being delivered</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="stringliteral">        @param tofile delivery destination</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="stringliteral">        @param verifyfile temporary file that failed verification&quot;&quot;&quot;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        DeliveryFailed.__init__(self,message,fromfile,tofile)</div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1VerificationFailed.html#aebdce07771218b4e20d0feaf9285d9f4">  125</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1VerificationFailed.html#aebdce07771218b4e20d0feaf9285d9f4">verifyfile</a>=verifyfile</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="comment">##@var verifyfile</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">    # The file to verify</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1VerificationFailed.html#ad4db0e82790c06f70b8c78abf98e88b4">  129</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1VerificationFailed.html#ad4db0e82790c06f70b8c78abf98e88b4">__str__</a>(self):</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Human-readable description of this error.&quot;&quot;&quot;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;%s: verification failed on temporary file %s (from %s): %s&#39;</span>%\</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            (self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#aada16d988676d50769c3e0dd94206d24">tofile</a>,self.<a class="code" href="classprodutil_1_1fileop_1_1VerificationFailed.html#aebdce07771218b4e20d0feaf9285d9f4">verifyfile</a>,self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a50fea4b7bb0919d0c0a4e91cf94ae583">fromfile</a>,self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a5d547c2c860f6031087f47fed33fa0c3">message</a>)</div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1VerificationFailed.html#ae605b37f98840c374775e3c32e495d4d">  133</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1VerificationFailed.html#ae605b37f98840c374775e3c32e495d4d">__repr__</a>(self):</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Pythonic representation of this error.&quot;&quot;&quot;</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;VerificationFailed(%s,%s,%s,%s)&#39;</span>%\</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            (repr(self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a5d547c2c860f6031087f47fed33fa0c3">message</a>),repr(self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a50fea4b7bb0919d0c0a4e91cf94ae583">fromfile</a>),repr(self.<a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html#aada16d988676d50769c3e0dd94206d24">tofile</a>),repr(self.<a class="code" href="classprodutil_1_1fileop_1_1VerificationFailed.html#aebdce07771218b4e20d0feaf9285d9f4">verifyfile</a>))</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#acbb763446440b42b162566b0821b8212">  139</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#acbb763446440b42b162566b0821b8212">realcwd</a>():</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Returns the current working directory, expanding any symbolic</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="stringliteral">    links.&quot;&quot;&quot;</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">return</span> os.path.realpath(os.getcwd())</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a5b700e0da6a39676498832a268418628">  144</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a5b700e0da6a39676498832a268418628">chdir</a>(path,logger=None):</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Changes to the specified directory.  Please use</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="stringliteral">    produtil.cd.NamedDir instead.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="stringliteral">    This is generally not a good idea since you will not cd back if an</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="stringliteral">    unhandled exception is raised.  It is better to use the</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="stringliteral">    produtil.cd module, which provides ways to enter a directory in a</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="stringliteral">    &quot;with&quot; block and optionally delete it afterwards.  Such</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral">    functionality could also be implemented via a try...finally block.</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="stringliteral">    @param path the path to cd to</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral">    @param logger a logging.Logger for log messages&quot;&quot;&quot;</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    path=str(path)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: logger.info(path+<span class="stringliteral">&#39;: cd here&#39;</span>)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        os.chdir(path)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        logger.warning(path+<span class="stringliteral">&#39;: cannot cd: &#39;</span>+str(e),exc_info=<span class="keyword">True</span>)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">raise</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#ade91f28b05a8489a0ee7a5d648f0c6b9">  163</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#ade91f28b05a8489a0ee7a5d648f0c6b9">touch</a>(filename, times=None):</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Open the file for append and set mtime and atime. </span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="stringliteral">    Opens the specified file in append mode, but writes nothing.  Sets</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="stringliteral">    the access and modification times. </span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="stringliteral">    @param filename the string filename</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="stringliteral">    @param times A 2-tuple of numbers, of the form (atime, mtime). </span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="stringliteral">      These are UNIX epoch times (seconds since 1970 began in UTC).&quot;&quot;&quot;</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    with open(filename, <span class="stringliteral">&#39;a&#39;</span>):</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        os.utime(filename, times)</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a2fd8f9c1342cfe0a7f827cb6e6b16980">  176</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a2fd8f9c1342cfe0a7f827cb6e6b16980">netcdfver</a>(filename):</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!What is the NetCDF version of this file?</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="stringliteral">    Returns one of three strings based on the NetCDF version of the</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="stringliteral">    given file, or returns None if the file is not NetCDF:</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="stringliteral">     *  &quot;CDF1&quot; = NetCDF classic format</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="stringliteral">     *  &quot;CDF2&quot; = NetCDF 64-bit offset format</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="stringliteral">     *  &quot;HDF5&quot; = HDF5 file, and hence possibly a NetCDF4 file.</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="stringliteral">     *  None   = Not NetCDF and not HDF5</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="stringliteral">    @param filename the name of the file to test&quot;&quot;&quot;</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    with open(filename,<span class="stringliteral">&#39;rb&#39;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        eight=f.read(8)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> len(eight)&lt;4:</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        four=eight[0:4]</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">if</span> four==<span class="stringliteral">&#39;CDF\x01&#39;</span>:</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;CDF1&quot;</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordflow">elif</span> four==<span class="stringliteral">&#39;CDF\x02&#39;</span>:</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;CDF2&quot;</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">elif</span> eight==<span class="stringliteral">&#39;\x89\x48\x44\x46\x0d\x0a\x1a\x0a&#39;</span>:</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;HDF5&quot;</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#ab40f65aa984bb2e3fdf5a45803e4a51a">  200</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#ab40f65aa984bb2e3fdf5a45803e4a51a">gribver</a>(filename):</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!What is the GRIB version of this file?</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="stringliteral">    Returns the GRIB file version: 1 or 2.  If the file is not a GRIB</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="stringliteral">    file, or if the answer is indeterminate, returns None.  Only the</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="stringliteral">    first GRIB record is tested.</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="stringliteral">    @param filename the path to the file to test&quot;&quot;&quot;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(filename,str):</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">raise</span> TypeError(<span class="stringliteral">&#39;The first argument to gribver should be &#39;</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                        <span class="stringliteral">&#39;a filename.  You provided a %s %s.&#39;</span>%</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                        (type(filename).__name__,repr(filename)))</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> <a class="code" href="namespaceprodutil_1_1fileop.html#a306d0b77df75fde3f04e77c51c3b0abb">isnonempty</a>(filename):</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    with open(filename,<span class="stringliteral">&#39;rb&#39;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        eight=f.read(8)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">if</span> eight==<span class="stringliteral">&#39;GRIB\x00\x00\x00\x02&#39;</span>:</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordflow">return</span> 2</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">elif</span> eight[0:4]==<span class="stringliteral">&#39;GRIB&#39;</span>:</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="keywordflow">return</span> 1</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a82b5e696cfbd8f4c4ed72c9d37f34e18">  223</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a82b5e696cfbd8f4c4ed72c9d37f34e18">makedirs</a>(filename,numtries=10,logger=None):</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Make a directory tree, working around filesystem bugs.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="stringliteral">    This makedirs implementation works around a common bug: if two</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="stringliteral">    processes try to recursively make a directory tree simultaneously,</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="stringliteral">    makedirs can fail when two processes make the same path component</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="stringliteral">    at the same time.  This implementation automatically retries in</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="stringliteral">    that situation.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="stringliteral">    @param filename the directory path</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="stringliteral">    @param numtries the number of times to retry</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="stringliteral">    @param logger a logging.Logger for log messages&quot;&quot;&quot;</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordflow">for</span> n <span class="keywordflow">in</span> range(numtries):</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isdir(filename):</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    logger.info(filename+<span class="stringliteral">&#39;: make directory and parents&#39;</span>)</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                os.makedirs(filename)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            <span class="keywordflow">if</span> os.path.isdir(filename):</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keywordflow">elif</span> os.path.exists(filename):</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                <span class="keywordflow">raise</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">elif</span> n==numtries-1:</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keywordflow">continue</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">raise</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">########################################################################    </span></div><div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#ad7b3ccb99913d2bedcaabf98c58e6dd8">  250</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#ad7b3ccb99913d2bedcaabf98c58e6dd8">remove_file</a>(filename,info=True,logger=None):</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Deletes the specified file.  </span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="stringliteral">    Does nothing if the filename is None, is the empty string or</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="stringliteral">    already does not exist.  Otherwise, the file is deleted.</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="stringliteral">    @param filename The file to delete.</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="stringliteral">    @param info Optional: indicates that warnings about a file already</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="stringliteral">    not existing should be sent to the logger at INFO level</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="stringliteral">    (info=True) instead of WARNING (info=False).</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="stringliteral">    @param logger the logging.Logger for messages&quot;&quot;&quot;</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span> filename <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> filename==<span class="stringliteral">&#39;&#39;</span>:</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">return</span> <span class="comment"># nothing to do</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: logger.info(<span class="stringliteral">&#39;%s: remove file&#39;</span>%(filename,))</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        os.unlink(filename)</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">if</span> e.errno!=errno.ENOENT: <span class="comment"># ENOENT = file does not exist</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: </div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                logger.warning(<span class="stringliteral">&#39;%s: cannot remove: %s&#39;</span>%(filename,str(e)),</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                               exc_info=<span class="keyword">True</span>)</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="keywordflow">raise</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: </div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            log=logger.info <span class="keywordflow">if</span> info <span class="keywordflow">else</span> logger.warning</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            log(<span class="stringliteral">&#39;%s: cannot remove; does not exist: %s&#39;</span>%(filename,str(e)))</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a9939944f5ea130c4557a137206abcec6">  275</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a9939944f5ea130c4557a137206abcec6">rmall</a>(*args,**kwargs):</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Deletes the specified list of files.  </span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="stringliteral">    Deletes files listed in &quot;args&quot;.  Each one is passed to</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="stringliteral">    remove_file.  Exceptions that derive from EnvironmentError are</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="stringliteral">    collected, and will be raised at the end, thus allowing removal of</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="stringliteral">    later files to continue if earlier ones failed.  If only one file</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="stringliteral">    causes an exception, that exception will be raised, otherwise</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="stringliteral">    FileOpErrors will be raised</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="stringliteral">    @param args The files to delete.</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="stringliteral">    @param kwargs Keyword arguments passed to remove_file().&quot;&quot;&quot;</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    logger=kwargs.get(<span class="stringliteral">&#39;logger&#39;</span>,<span class="keywordtype">None</span>)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        logger.info(<span class="stringliteral">&#39;Removing %d files...&#39;</span>%(len(args),))</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    ex=list()</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">for</span> arg <span class="keywordflow">in</span> args:</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <a class="code" href="namespaceprodutil_1_1fileop.html#ad7b3ccb99913d2bedcaabf98c58e6dd8">remove_file</a>(arg,**kwargs)</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            ex.append( (arg,<span class="keywordtype">None</span>,e) )</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">if</span> len(ex)==1:</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">raise</span> ex[0][1]</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">elif</span> len(ex)&gt;1:</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        msg=<span class="stringliteral">&#39;Multiple exceptions caught while deleting files in rmall.&#39;</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: logger.warning(msg)</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1FileOpErrors.html">FileOpErrors</a>(msg,<span class="stringliteral">&#39;,&#39;</span>.join(args),</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                           [ (a,b,str(c)) <span class="keywordflow">for</span> a,b,c <span class="keywordflow">in</span> ex ] )</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        logger.info(<span class="stringliteral">&#39;Done removing %d files...&#39;</span>%(len(args),))</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a89943b625d848173605fa3b8578d9ed1">  306</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a89943b625d848173605fa3b8578d9ed1">lstat_stat</a>(filename,raise_nonexist=False):</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Runs lstat and stat on a file as efficiently as possible.</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="stringliteral">    Returns (lstat(filename),stat(filename)) where each is None if it</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="stringliteral">    fails due to non-existence.  Does this in as few filesystem</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="stringliteral">    metadata operations as possible.  Will raise an exception if the</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="stringliteral">    stat fails for any reason other than non-existence of a file, or</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="stringliteral">    if the file or linked file is non-existent and</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="stringliteral">    raise_nonexist=True.</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="stringliteral">    @param filename The file to test.</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="stringliteral">    @param raise_nonexist Should we raise an exception if the file does not exist?</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="stringliteral">    @returns a tuple (L,S) where L is the lstat return value, and S is</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="stringliteral">      the stat return value.  Each will be None if the file or link</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="stringliteral">      target do not exist.&quot;&quot;&quot;</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    assert(filename <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    (xlstat,xstat)=(<span class="keywordtype">None</span>,<span class="keywordtype">None</span>)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        xlstat=os.lstat(filename)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> stat.S_ISLNK(xlstat.st_mode):</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="keywordflow">return</span> (xlstat,xlstat)</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        xstat=os.stat(filename)</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">if</span> raise_nonexist <span class="keywordflow">or</span> e.errno!=errno.ENOENT:</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="keywordflow">raise</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">return</span> (xlstat,xstat)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a306d0b77df75fde3f04e77c51c3b0abb">  332</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a306d0b77df75fde3f04e77c51c3b0abb">isnonempty</a>(filename):</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Returns True if the filename refers to an existent file that is</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="stringliteral">    non-empty, and False otherwise.</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="stringliteral">    @param filename The file to test.&quot;&quot;&quot;</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">if</span> filename <span class="keywordflow">is</span> <span class="keywordtype">None</span>:           <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    sfile=str(filename)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> sfile <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> sfile==<span class="stringliteral">&#39;&#39;</span>: <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    (l,s) = <a class="code" href="namespaceprodutil_1_1fileop.html#a89943b625d848173605fa3b8578d9ed1">lstat_stat</a>(filename)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    ret=s <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> s.st_size&gt;0</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">return</span> ret</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">########################################################################    </span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a8c8cfc6d9254517b452181daa7b594cb">deliver_file</a>(infile,outfile,keep=True,verify=False,blocksize=1048576,</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                 tempprefix=None,permmask=0o002,removefailed=True,</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                 logger=None,preserve_perms=True,preserve_times=True,</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                 preserve_group=None,copy_acl=None,moveok=True, </div><div class="line"><a name="l00348"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a8c8cfc6d9254517b452181daa7b594cb">  348</a></span>&#160;                 force=True, copier=None):</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This moves or copies the file &quot;infile&quot; to &quot;outfile&quot; in a unit</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="stringliteral">    operation; outfile will never be seen in an incomplete state.</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="stringliteral">    If the caller specifies keep=False (default is True) and</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="stringliteral">    moveok=True, and the source and destination are on the same</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="stringliteral">    filesystem then the delivery is done with a simple move.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="stringliteral">    Otherwise a copy is done to a temporary file on the same</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="stringliteral">    filesystem as the target.  If verification is requested</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="stringliteral">    (verify=True) then the temporary file is verified by filecmp.cmp,</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="stringliteral">    before moving the temporary file to the final location.</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="stringliteral">    When requested, and when possible, the permissions and ownership</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="stringliteral">    are preserved.  Both copy_acl and preserve_group have defaults set</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="stringliteral">    by the produtil.cluster module.  If the cluster uses access</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="stringliteral">    control lists for data restriction classes, then copy_acl will be</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="stringliteral">    set to True, otherwise it is false.  If group quotas are enabled,</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="stringliteral">    preserve_group is False, otherwise it is True.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="stringliteral">    @note The original file is never deleted, but it may be moved to</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="stringliteral">    the target if keep=False.  If a copy is done instead, the original</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="stringliteral">    file is still present.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="stringliteral">    @param infile the origin file</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="stringliteral">    @param outfile the destination file or its parent directory</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="stringliteral">    @param keep If False, the original file is no longer needed.  If False</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="stringliteral">      and moveok=True, the file might be delivered by a &quot;mv&quot;</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="stringliteral">      operation, avoiding any data duplication (no &quot;cp&quot;).</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="stringliteral">    @param verify If a &quot;cp&quot; is done, reopen the target and source and</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="stringliteral">      verify they are the same.  Note that providing a copier will </span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="stringliteral">      break the verification functionality if the copier changes the</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="stringliteral">      contents of the destination file (such as a copier that compresses).</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="stringliteral">    @param blocksize block size during copy operations</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="stringliteral">    @param tempprefix Prefix for temporary files during copy operations.</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="stringliteral">      Do not include directory paths in the tempprefix.</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="stringliteral">    @param permmask Permission bits to remove Default: world write (002)</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="stringliteral">    @param removefailed If True, delete temporary files if the delivery fails</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="stringliteral">    @param logger the logging.Logger for log messages.</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="stringliteral">    @param preserve_perms If True, copy the old file&#39;s permissions to</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="stringliteral">      the new file</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="stringliteral">    @param preserve_times If True, copy the old file&#39;s timestamps to</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="stringliteral">      the new file</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="stringliteral">    @param preserve_group If True, copy the old file&#39;s group ID to the</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="stringliteral">      new file</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="stringliteral">    @param copy_acl If True, copy the access control lists from one file </span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="stringliteral">      to another</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="stringliteral">    @param moveok If True, delivery by &quot;mv&quot; is allowed.  Must also set</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="stringliteral">      keep=False.</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="stringliteral">    @param force If False, delivery will be aborted (raise</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="stringliteral">      TargetFileExists) if the target file already exists.</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="stringliteral">    @param copier If present, this function or callable object is used to</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="stringliteral">      copy data from the source file to the temporary file before moving</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="stringliteral">      it to the target.  The copier is called as </span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="stringliteral">           copier(infile,temp_file_name,temp_file_object)</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="stringliteral">      Where the temp_file_name is the name of the destination file and</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="stringliteral">      the temp_file_object is an object that can be used to write to </span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="stringliteral">      the file.  The copier should NOT close the temp_file_object. &quot;&quot;&quot;</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">if</span> preserve_group <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        preserve_group = <span class="keywordflow">not</span> <a class="code" href="namespaceprodutil_1_1cluster.html#abc32f04e267a14ae8707ed672f7373fc">produtil.cluster.group_quotas</a>()</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">if</span> copy_acl <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        copy_acl = <a class="code" href="namespaceprodutil_1_1cluster.html#aa06e2671512c276fcee1dd7c441a7f98">produtil.cluster.use_acl_for_rstdata</a>()</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="keywordflow">if</span> copier <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="comment"># Cannot simply do a &quot;move&quot; if we are using an external</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="comment"># function to copy.</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        keep=<span class="keyword">True</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    assert(infile <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>)</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    assert(outfile <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>)</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    inbase=os.path.basename(infile)</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    (ilstat,istat)=<a class="code" href="namespaceprodutil_1_1fileop.html#a89943b625d848173605fa3b8578d9ed1">lstat_stat</a>(infile,raise_nonexist=<span class="keyword">True</span>)</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">if</span> stat.S_ISDIR(istat.st_mode):</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html">DeliveryFailed</a>(<span class="stringliteral">&#39;This subroutine cannot deliver directories.&#39;</span>,</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                             infile,outfile)</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment"># The outfile may be a directory, in which case we copy to a file</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment"># with the same name as the source, in that directory:</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    actual_outfile=outfile <span class="comment"># actual path of target file</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    outdir=<span class="keywordtype">None</span> <span class="comment"># parent directory of target file</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    (oflstat,ofstat)=<a class="code" href="namespaceprodutil_1_1fileop.html#a89943b625d848173605fa3b8578d9ed1">lstat_stat</a>(actual_outfile) <span class="comment"># stat on target file</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    (odlstat,odstat)=(<span class="keywordtype">None</span>,<span class="keywordtype">None</span>) <span class="comment"># stat on target file&#39;s parent directory</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="keywordflow">if</span> ofstat <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">if</span> stat.S_ISDIR(ofstat.st_mode):</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            outdir=actual_outfile</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            actual_outfile=os.path.join(outfile,inbase)</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            (odlstat,odstat)=(oflstat,ofstat)</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                logger.debug(<span class="stringliteral">&#39;%s: is a directory; file is %s&#39;</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                             %(outfile,inbase))</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            (oflstat,ofstat)=<a class="code" href="namespaceprodutil_1_1fileop.html#a89943b625d848173605fa3b8578d9ed1">lstat_stat</a>(actual_outfile)</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">if</span> odlstat <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        outdir=os.path.dirname(outfile)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">if</span> len(outdir)&lt;1: outdir=<span class="stringliteral">&#39;.&#39;</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            logger.debug(<span class="stringliteral">&#39;%s: exists, so parent %s must exist and be a &#39;</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                         <span class="stringliteral">&#39;directory&#39;</span>%(outfile,outdir))</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        (odlstat,odstat)=<a class="code" href="namespaceprodutil_1_1fileop.html#a89943b625d848173605fa3b8578d9ed1">lstat_stat</a>(outdir,raise_nonexist=<span class="keyword">True</span>)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">if</span> odstat <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html">DeliveryFailed</a>(<span class="stringliteral">&#39;Target does not exist, and parent of &#39;</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                                 <span class="stringliteral">&#39;target does not exist.&#39;</span>,infile,outfile)</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> stat.S_ISDIR(odstat.st_mode):</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1DeliveryFailed.html">DeliveryFailed</a>(<span class="stringliteral">&#39;Target does not exist, and parent of &#39;</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                                 <span class="stringliteral">&#39;target is not a directory.&#39;</span>,infile,outfile)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">if</span> odstat <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> <span class="keywordflow">not</span> force:</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span>  <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            logger.debug(<span class="stringliteral">&#39;%s: exists and overwrite (force) is disabled.  &#39;</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                         <span class="stringliteral">&#39;Aborting delivery.&#39;</span>%(actual_outfile,))</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment"># Handle a special case: the source and destination are the same</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment"># and the destination is not a symlink.  In that case, we have</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment"># nothing to do and can simply return.</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">if</span> ofstat <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">if</span> stat.S_ISLNK(ofstat.st_mode):</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                logger.info(<span class="stringliteral">&#39;%s: destination is a link, will recopy as &#39;</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                            <span class="stringliteral">&#39;a non-link.&#39;</span>%(actual_outfile,))</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">elif</span> os.path.samestat(istat,ofstat):</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                logger.info(<span class="stringliteral">&#39;%s: same as %s&#39;</span>%(actual_outfile,infile))</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="keywordflow">return</span> <span class="comment"># nothing to do</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            logger.info(<span class="stringliteral">&#39;%s: exists, replacing with %s&#39;</span>%(</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                    actual_outfile,infile))</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">elif</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        logger.debug(<span class="stringliteral">&#39;%s: does not exist&#39;</span>%(actual_outfile))</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="comment"># Handle another case: if we&#39;re not required to keep the origin,</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment"># the origin is in the same file as the target, and the origin is</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment"># not a link, and moveok=True, we can deliver the file by an</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment"># os.rename</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    samefs = (istat.st_dev == odstat.st_dev)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> samefs <span class="keywordflow">and</span> <span class="keywordflow">not</span> keep <span class="keywordflow">and</span> moveok:</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">if</span> stat.S_ISLNK(ilstat.st_mode):</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                logger.info(<span class="stringliteral">&#39;%s: cannot deliver via &quot;os.rename&quot; since &#39;</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                            <span class="stringliteral">&#39;source is a link.&#39;</span>%(infile,))</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                logger.info(<span class="stringliteral">&#39;%s: move from %s&#39;</span>%(actual_outfile,infile))</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                os.rename(infile,actual_outfile)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <span class="keywordflow">return</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                    logger.info(<span class="stringliteral">&#39;%s: could not deliver by os.rename: %s&#39;</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                                %(actual_outfile,str(e)))</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                </div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment"># If we get here, then the files are in different filesystems or</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="comment"># we&#39;re being asked to keep a copy or os.rename failed.  That</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="comment"># means we need to copy to a temporary file and move it to the</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment"># destination.</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    temp=<span class="keywordtype">None</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    tempname=<span class="keywordtype">None</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="comment"># Copy to a temporary file:</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="keywordflow">if</span> tempprefix <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            tempprefix=<span class="stringliteral">&quot;tmp.&quot;</span>+inbase+<span class="stringliteral">&quot;.part.&quot;</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        temp=tempfile.NamedTemporaryFile(prefix=tempprefix,</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                         delete=<span class="keyword">False</span>,dir=outdir)</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        tempname=temp.name</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            logger.info(<span class="stringliteral">&#39;%s: copy to temporary %s&#39;</span>%(infile,tempname))</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">if</span> copier <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            with open(infile,<span class="stringliteral">&#39;rb&#39;</span>) <span class="keyword">as</span> indata:</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                shutil.copyfileobj(indata,temp,length=blocksize)</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            copier(infile,tempname,temp)</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        temp.close()</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        temp=<span class="keywordtype">None</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">if</span> verify:</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                logger.info(<span class="stringliteral">&#39;%s: verify copy %s&#39;</span>%(infile,tempname))</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> filecmp.cmp(infile,tempname):</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1VerificationFailed.html">VerificationFailed</a>(<span class="stringliteral">&#39;filecmp.cmp returned False&#39;</span>,</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                                         infile,actual_outfile,tempname)</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            logger.info(<span class="stringliteral">&#39;%s: copy group ID and permissions to %s&#39;</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                        %(infile,tempname,))</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="comment"># Copy group ID and permissions:</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">if</span> preserve_group:</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                os.chown(tempname,-1,istat.st_gid)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            except(IOError,OSError) <span class="keyword">as</span> e:</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                <span class="comment"># Usually this is not an error: it means the user is</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                <span class="comment"># not in the group</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                    logger.warning(<span class="stringliteral">&#39;%s: cannot copy groupid to %s: %s&#39;</span> </div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                                   % (infile,tempname,str(e)))</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordflow">if</span> preserve_perms:</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            os.chmod(tempname,istat.st_mode&amp;~permmask)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="comment">#FIXME: COPY ACLS HERE</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="comment"># Move to the final location:</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            logger.info(<span class="stringliteral">&#39;%s: move from %s&#39;</span>%(actual_outfile,tempname))</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">if</span> preserve_times:</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            os.utime(tempname,(istat.st_atime,istat.st_mtime))</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        os.rename(tempname,actual_outfile)</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        tempname=<span class="keywordtype">None</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            logger.error(<span class="stringliteral">&#39;%s: delivery failed: %s&#39;</span>%(infile,str(e)))</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="keywordflow">raise</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">finally</span>:</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="keywordflow">if</span> temp <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                temp.close()</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <span class="keywordflow">if</span> removefailed <span class="keywordflow">and</span> tempname <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                os.unlink(tempname)</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <span class="keywordflow">pass</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00562"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#aa520f12ba7897ddfa1ab2894de7ebd64">  562</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#aa520f12ba7897ddfa1ab2894de7ebd64">find_exe</a>(name,dirlist=None,raise_missing=True):</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Searches the $PATH or a specified iterable of directory names</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="stringliteral">    to find an executable file with the given name.  </span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="stringliteral">    Returns the executable&#39;s location.  If the executable cannot be</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="stringliteral">    found, and raise_missing=True, raises CannotFindExe, otherwise</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="stringliteral">    returns None.  Raises FindExeInvalidExeName if &quot;name&quot; is not the</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="stringliteral">    same as its os.path.basename.</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="stringliteral">    @param name The name of the executable to find.</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="stringliteral">    @param dirlist The list of directories to search, or None to search $PATH</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="stringliteral">    @param raise_missing If True, the CannotFindExe exception is</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="stringliteral">      raised for executables that cannot be found.  If False, return</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="stringliteral">      None in that situation.&quot;&quot;&quot;</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    bn=os.path.basename(name)</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">if</span> bn != name:</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1FindExeInvalidExeName.html">FindExeInvalidExeName</a>(</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="stringliteral">&#39;executable name is not the same as its basename in &#39;</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="stringliteral">&#39;find_exe (basename=%s)&#39;</span>%(bn,),name)</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keywordflow">if</span> dirlist <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        dirlist=os.environ[<span class="stringliteral">&#39;PATH&#39;</span>].split(<span class="stringliteral">&#39;:&#39;</span>)</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">for</span> dirname <span class="keywordflow">in</span> dirlist:</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">if</span> dirname==<span class="stringliteral">&#39;&#39;</span>: dirname=<span class="stringliteral">&#39;.&#39;</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        exename=os.path.join(dirname,name)</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">if</span> os.path.isfile(exename) <span class="keywordflow">and</span> os.access(exename,os.X_OK):</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            <span class="keywordflow">return</span> exename</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> raise_missing: <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1CannotFindExe.html">CannotFindExe</a>(<span class="stringliteral">&#39;cannot find executable&#39;</span>,name)</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a5fab248eba83d35a1c45ababa9dc3a23">  593</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a5fab248eba83d35a1c45ababa9dc3a23">symlink_read_test</a>(filename,readsize=40,logger=None):</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Opens the specified file for reading and attempts to read data</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="stringliteral">    to it.  Logs the process.  Will NOT raise any I/O or system</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="stringliteral">    errors; they are ignored.  This is a workaround for a bug in Cray:</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="stringliteral">    symlinks to recently created files cannot be read by the compute</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="stringliteral">    node unless the batch node reads from them first (or unless you</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="stringliteral">    wait a while).&quot;&quot;&quot;</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        with open(filename,<span class="stringliteral">&#39;rt&#39;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            buf=f.read(readsize)</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                logger.info(<span class="stringliteral">&#39;%s: read %s&#39;</span>%(filename,repr(buf)))</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keywordflow">pass</span> <span class="comment"># ignore I/O and OS errors</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a4ac1bf31c05016a535219e6a96cf7740">make_symlinks_in</a>(sources,targetdir,force=False,renamer=None,logger=None,</div><div class="line"><a name="l00609"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a4ac1bf31c05016a535219e6a96cf7740">  609</a></span>&#160;                     copy=False):</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Creates symbolic links from a set of source files to a target</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="stringliteral">    directory.  If &quot;force&quot; is True, then any existing files will first</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="stringliteral">    be deleted.</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="stringliteral">    The &quot;renamer&quot; can be a function that generates paths of the</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="stringliteral">    symlinks, relative to targetdir, for each symlink in &quot;sources&quot;.</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="stringliteral">    If the return value from &quot;renamer&quot; is an absolute path, an</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="stringliteral">    exception will be thrown.  If the return value is None, then no</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="stringliteral">    link will be made.</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="stringliteral">    Example:</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="stringliteral">    make_symlinks_in([&#39;/path/to/a&#39;,&#39;/path/to/b&#39;],&#39;.&#39;,</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="stringliteral">      renamer=lambda s: os.path.basename(s)+&#39;.linkified&#39;)</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="stringliteral">    will create a.linkified, linked to /path/to/a, and b.linkified,</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="stringliteral">    linked to /path/to/b in directory &quot;.&quot; </span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="stringliteral">    @param sources The list of files to link to.</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="stringliteral">    @param targetdir The directory in which to place the links.</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="stringliteral">    @param force Remove existing files if needed.</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="stringliteral">    @param renamer Function to generate link names.</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="stringliteral">    @param logger A logging.Logger for log messages.</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="stringliteral">    @param copy If True, files are copied instead of linked.&quot;&quot;&quot;</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    (tlstat,tstat)=<a class="code" href="namespaceprodutil_1_1fileop.html#a89943b625d848173605fa3b8578d9ed1">lstat_stat</a>(targetdir,raise_nonexist=<span class="keyword">True</span>)</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> stat.S_ISDIR(tstat.st_mode):</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1CannotLinkMulti.html">CannotLinkMulti</a>(<span class="stringliteral">&#39;target is not a directory&#39;</span>,targetdir)</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    errors=[]</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="keywordflow">for</span> source <span class="keywordflow">in</span> sources:</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        target=<span class="keywordtype">None</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="keywordflow">if</span> renamer <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                target=renamer(source)</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                <span class="keywordflow">if</span> target <span class="keywordflow">is</span> <span class="keywordtype">None</span>: <span class="keywordflow">continue</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                <span class="keywordflow">if</span> os.path.isabs(target):</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                    <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1UnexpectedAbsolutePath.html">UnexpectedAbsolutePath</a>(</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                        <span class="stringliteral">&#39;renamed path is absolute&#39;</span>,renamed)</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                target=os.path.join(targetdir,target)</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                target=os.path.join(targetdir,os.path.basename(source))</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;            <span class="keywordflow">if</span> copy:</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                <span class="keywordflow">if</span> os.path.exists(source):</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                    <span class="keywordflow">if</span> force <span class="keywordflow">and</span> os.path.exists(target):</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                        os.unlink(target)</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                    <a class="code" href="namespaceprodutil_1_1fileop.html#a8c8cfc6d9254517b452181daa7b594cb">deliver_file</a>(source,target,keep=<span class="keyword">True</span>,logger=logger)</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                <span class="keywordflow">elif</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                    logger.warning(</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                        <span class="stringliteral">&#39;%s: skip.  Am in copy mode, and source does not exist (%s)&#39;</span>%(</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                            target,source))</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <a class="code" href="namespaceprodutil_1_1fileop.html#ac56ac21b38401c2c8dc23191f13a58ae">make_symlink</a>(source,target,force=force,logger=logger)</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            errors.append( (source,str(target),str(e)) )</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                logger.warning(str(e),exc_info=<span class="keyword">True</span>)</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">if</span> len(errors)&gt;0:</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1FileOpError.html">FileOpError</a>(<span class="stringliteral">&#39;cannot link files&#39;</span>,targetdir,errors)</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#ac56ac21b38401c2c8dc23191f13a58ae">  666</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#ac56ac21b38401c2c8dc23191f13a58ae">make_symlink</a>(source,target,force=False,logger=None,max_tries=20):</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Creates a symbolic link &quot;target&quot; that points to &quot;source&quot;.  If</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="stringliteral">    the target already exists and is NOT a directory, then the file</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="stringliteral">    will be replaced.  The replacement is done in a unit operation so</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="stringliteral">    that the target will always exist (unless the operation fails).</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="stringliteral">    @param source The file to link to.</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="stringliteral">    @param target The name of the link.</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="stringliteral">    @param force If True, and target exists, delete it first.</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="stringliteral">    @param logger a logging.Logger for log messages.&quot;&quot;&quot;</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordtype">None</span>: logger=module_logger</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        logger.info(<span class="stringliteral">&#39;link %s -&gt; %s&#39;</span>%(target,source))</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">if</span> os.path.isdir(target):</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        target=os.path.join(target,os.path.basename(source))</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            logger.info(<span class="stringliteral">&#39;Target is a directory.  Symlink to %s instead&#39;</span>%(target,))</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        os.symlink(source,target)</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        content=os.readlink(target)</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="keywordflow">if</span> content!=source:</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            msg=<span class="stringliteral">&quot;FILESYSTEM FAILURE: Cannot symlink \&quot;%s\&quot; -&gt; \&quot;%s\&quot;.  Instead, the symlink is to \&quot;%s\&quot;.&quot;</span>%(target,source,content)</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                logger.critical(msg)</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1WrongSymlink.html">WrongSymlink</a>(msg,target)</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <span class="keywordflow">pass</span> <span class="comment"># symlink_read_test(target,logger=logger)</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> e.errno==errno.EEXIST <span class="keywordflow">or</span> <span class="keywordflow">not</span> force:</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <span class="keywordflow">raise</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="comment"># The file already exists</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            logger.info(<span class="stringliteral">&#39;target exists - using replace_symlink instead&#39;</span>)</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespaceprodutil_1_1fileop.html#adb7573cdfc47dc6e628f464d7371b246">replace_symlink</a>(source,target,logger=logger)</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#adb7573cdfc47dc6e628f464d7371b246">  700</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#adb7573cdfc47dc6e628f464d7371b246">replace_symlink</a>(source,target,logger=None,max_tries=20):</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Do not call this routine directly: you want make_symlink</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="stringliteral">    instead.  This routine creates a new symbolic link and renames</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="stringliteral">    that link to &quot;target.&quot;  That always replaces target with a</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="stringliteral">    symbolic link to source, even if target did not already exist.</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="stringliteral">    @param source the file to link from</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="stringliteral">    @param target the file to link to</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="stringliteral">    @param logger a logging.Logger for messages&quot;&quot;&quot;</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordtype">None</span>: logger=module_logger</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    tempname=os.path.join(os.path.dirname(target),</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;       <span class="stringliteral">&#39;tmp.%s.%06x.%06x.tmp&#39;</span> % ( os.path.basename(target),</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;           random.getrandbits(32),random.getrandbits(32)))</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            logger.info(<span class="stringliteral">&#39;link %s -&gt; %s&#39;</span>%(tempname,source))</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        os.symlink(source,tempname)</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        content=os.readlink(tempname)</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="keywordflow">if</span> content!=source:</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            msg=<span class="stringliteral">&quot;FILESYSTEM FAILURE: Cannot symlink \&quot;%s\&quot; -&gt; \&quot;%s\&quot;.  Instead, the symlink is to \&quot;%s\&quot;.&quot;</span>%(tempname,source,content)</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                logger.critical(msg)</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1WrongSymlink.html">WrongSymlink</a>(msg,tempname)</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            logger.info(<span class="stringliteral">&#39;rename %s to %s&#39;</span>%(tempname,target))</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        os.rename(tempname,target)</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="comment"># symlink_read_test(tempname,logger=logger)</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        <span class="keywordflow">if</span> isinstance(e,WrongSymlink): <span class="keywordflow">raise</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                logger.info(<span class="stringliteral">&#39;failed: delete %s&#39;</span>%(tempname,))</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            os.remove(tempname)</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">except</span> EnvironmentError: <span class="keywordflow">pass</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="keywordflow">raise</span> e</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00736"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a69d760bd1b5509d046f806001866466b">  736</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a69d760bd1b5509d046f806001866466b">unblock</a>(stream,logger=None):</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Attempts to modify the given stream to be non-blocking.  This</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="stringliteral">    only works with streams that have an underlying POSIX fileno, such</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="stringliteral">    as those from open.  </span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="stringliteral">    Will re-raise any exception received, other than AttributeError</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="stringliteral">    and EnvironmentError.  Hence, I/O errors and attempts to make a</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="stringliteral">    non-fileno stream non-blocking will produce a False return value,</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="stringliteral">    while anything else will raise an exception.</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="stringliteral">    @param stream the stream to unblock</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="stringliteral">    @param logger a logging.Logger for log messages</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="stringliteral">    @returns True on success, False otherwise.&quot;&quot;&quot;</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <a class="code" href="namespaceprodutil_1_1fileop.html#a7e01f7ab110986c9c031a54f48dbb626">call_fcntrl</a>(os.O_NONBLOCK,0,logger)</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a7e01f7ab110986c9c031a54f48dbb626">  751</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a7e01f7ab110986c9c031a54f48dbb626">call_fcntrl</a>(stream,on,off,logger=None):</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Internal function that implements unblock()</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="stringliteral">    @param stream the stream to modify</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="stringliteral">    @param on flags to turn on</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="stringliteral">    @param off flags to turn off</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="stringliteral">    @param logger a logging.Logger for messages</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="stringliteral">    @returns True on success, False otherwise.&quot;&quot;&quot;</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">if</span> isinstance(stream,int):</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            fd=stream</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            fd=stream.fileno()</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="keywordflow">except</span> (AttributeError,EnvironmentError) <span class="keyword">as</span> ee: </div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            logger.warning(<span class="stringliteral">&#39;%s: stream has no fileno, cannot switch to &#39;</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                           <span class="stringliteral">&#39;non-blocking I/O: %s&#39;</span>%</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                           (repr(stream),str(ee)),exc_info=<span class="keyword">True</span>)</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    </div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        flags=fcntl.fcntl(fd, fcntl.F_GETFL)</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        fcntl.fcntl(fd, fcntl.F_SETFL, (flags|on) &amp; ~off)</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> ee:</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            logger.error(<span class="stringliteral">&#39;%s: cannot switch to non-blocking I/O: %s&#39;</span>%</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                         (repr(stream),str(ee)),exc_info=<span class="keyword">True</span>)</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00781"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a29aad92d8a2f44c49b9358c3166a9d04">  781</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a29aad92d8a2f44c49b9358c3166a9d04">fortlink</a>(forts,force=False,basedir=None,logger=None):</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!This is a convenience routine that makes many symbolic links to</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="stringliteral">    fort.N files for various integers N using make_symlink.  It works</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="stringliteral">    similarly to fortcopy.  The optional basedir is the relative</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="stringliteral">    directory.  The optional force argument is passed on to</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="stringliteral">    make_symlink and has the usual meaning: replace existing files.</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="stringliteral">    Call like this:</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="stringliteral">    @code</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="stringliteral">      fortlink({ 15:&quot;/usr/local/share/file1&quot;,</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="stringliteral">                 23:&quot;./file2&quot;})</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="stringliteral">    @endcode</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="stringliteral">    And you will create these symbolic links:</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="stringliteral">    @code{.unformatted}</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="stringliteral">      ./fort.15 -&gt; /usr/local/share/file1</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="stringliteral">      ./fort.23 -&gt; ./file2</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="stringliteral">    @endcode</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="stringliteral">    as with other symlink routines in this module, set force=True to</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="stringliteral">    remove target fort.N files if they already exist.</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="stringliteral">    @param forts Mapping from Fortran unit number to link target.</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="stringliteral">    @param force Remove target files if they exist.</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="stringliteral">    @param basedir Where to make the links instead of the current directory.</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="stringliteral">    @param logger A logging.Logger for log messages.&quot;&quot;&quot;</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        logger.debug(<span class="stringliteral">&#39;in fortlink, forts=%s force=%s basedir=%s logger=%s&#39;</span>%(</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                repr(forts),repr(force),repr(basedir),repr(logger)))</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">for</span> (i,filename) <span class="keywordflow">in</span> forts.items():</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        assert(isinstance(filename,str))</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        link=<span class="stringliteral">&#39;fort.%d&#39;</span>%(int(i),)</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">if</span> basedir <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: link=os.path.join(basedir,where)</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <a class="code" href="namespaceprodutil_1_1fileop.html#ac56ac21b38401c2c8dc23191f13a58ae">make_symlink</a>(filename,link,force=force,logger=logger)</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a50459c609937539cd23961fac5245770">  815</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a50459c609937539cd23961fac5245770">fortcopy</a>(forts,basedir=None,logger=None,only_log_errors=False,**kwargs):</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!A convenience function for copying files to local fort.N files</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="stringliteral">    for various integers N using deliver_file(...,keep=True).  It</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="stringliteral">    works similarly to fortlink.  The force= argument tells fortcopy</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="stringliteral">    to overwrite existing files.  Otherwise, an exception will be</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="stringliteral">    raised if the destination file already exists.  The optional</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="stringliteral">    basedir argument is the parent directory of the fort.N.</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="stringliteral">    Call like this:</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="stringliteral">    @code</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="stringliteral">      fortcopy({ 15:&quot;/usr/local/share/file1&quot;,</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="stringliteral">                 23:&quot;./file2&quot;})</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="stringliteral">    @endcode</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="stringliteral">    And you will create files:</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="stringliteral">    @code{.unformatted}</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="stringliteral">      ./fort.15 (copied from /usr/local/share/file1)</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="stringliteral">      ./fort.23 (copied from ./file2)</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="stringliteral">    @endcode</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="stringliteral">    All other keyword arguments are sent to deliver_file.</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="stringliteral">    @param forts Mapping from Fortran unit number to copy target.</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="stringliteral">    @param basedir Where to put the files instead of the current directory.</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="stringliteral">    @param logger A logging.Logger for log messages.    </span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="stringliteral">    @param only_log_errors Only log failed operations instead of logging everything.</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="stringliteral">    @param kwargs All other keyword arguments are passed to deliver_file()&quot;&quot;&quot;</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">for</span> (i,filename) <span class="keywordflow">in</span> forts.items():</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        newfile=<span class="stringliteral">&#39;fort.%d&#39;</span>%(int(i),)</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="keywordflow">if</span> basedir <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: newfile=os.path.join(basedir,where)</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <a class="code" href="namespaceprodutil_1_1fileop.html#a8c8cfc6d9254517b452181daa7b594cb">deliver_file</a>(filename,newfile,logger=logger,**kwargs)</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        <span class="keywordflow">except</span> (EnvironmentError) <span class="keyword">as</span> ee:</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                logger.warning(<span class="stringliteral">&#39;%s: fortcopy could not copy to %s: %s&#39;</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                               %(filename,newfile,str(ee)))</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> only_log_errors:</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                    <span class="keywordflow">raise</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                <span class="comment"># Cannot log errors, so ignore the only_log_errors flag</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                <span class="keywordflow">raise</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00857"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#ab3398b00c8d1f23691dafa4972070a2d">  857</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#ab3398b00c8d1f23691dafa4972070a2d">norm_expand_path</a>(path=None,fullnorm=False):</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Normalizes path and expand home directories.</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="stringliteral">    Calls os.path.normpath and os.path.expanduser on its argument, or</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="stringliteral">    on os.getcwd() if no argument is supplied (or if path=None).  This</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="stringliteral">    removes extraneous a/./b, a/../b, expands ~username and ~, and</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="stringliteral">    other system-specific expansions.  See the Python documentation of</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="stringliteral">    normpath and expanduser for details.  Will also call realpath and</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="stringliteral">    normcase if fullnorm=True.  Raises RelativePathError if the</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="stringliteral">    resulting path is not absolute.</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="stringliteral">    @param path the path to expand</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="stringliteral">    @param fullnorm If True, call os.path.normcase() and</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="stringliteral">      os.path.realpath() normapth and expanduser.&quot;&quot;&quot;</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">if</span> path <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        path=os.getcwd()</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    normpath=os.path.normpath(os.path.expanduser(path))</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">if</span> fullnorm:</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        normpath=os.path.normcase(os.path.realpath(normpath))</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isabs(normpath):</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <span class="keywordflow">raise</span> <a class="code" href="classprodutil_1_1fileop_1_1RelativePathError.html">RelativePathError</a>(</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            <span class="stringliteral">&#39;%s: path is relative, not absolute (expands to %s)&#39;</span>%</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                (path,normpath))</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">return</span> normpath</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a8a3633e9dc781dd59dc362fe65d915cd">  881</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a8a3633e9dc781dd59dc362fe65d915cd">norm_abs_path</a>(rel,fromdir=None):</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Return relative path.</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="stringliteral">    This routine generates relative file paths (using os.path.relpath)</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="stringliteral">    that are relative to the specified &quot;from&quot; directory fromdir.  The</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="stringliteral">    fromdir will be first sent through norm_expand_path to eliminate</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="stringliteral">    system-specific weirdness, such as a/./b, a/../b, ~username and so</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="stringliteral">    on.  This will raise RelativePathError if the resulting path is</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="stringliteral">    not absolute.</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="stringliteral">    @param rel the path </span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="stringliteral">    @param fromdir the directory from which we want the relative path&quot;&quot;&quot;</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">return</span> os.path.relpath(rel,<a class="code" href="namespaceprodutil_1_1fileop.html#ab3398b00c8d1f23691dafa4972070a2d">norm_expand_path</a>(fromdir))</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00895"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a1c2c05b48921c3397b98c51e8ae71238">  895</a></span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a1c2c05b48921c3397b98c51e8ae71238">check_last_lines</a>(filename,searchstr,lastbytes=10000,logger=None):</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Checks the last few bytes of a file to see if the specified</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="stringliteral">    search string is present.  Returns True if the string is present</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="stringliteral">    or False if the file existed but the string was not present.  Will</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="stringliteral">    raise an exception if the file is non-existent or cannot be read.</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="stringliteral">    @param filename The file to search (a string).</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="stringliteral">    @param searchstr The string to search for.  Must not contain </span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="stringliteral">        end-of-line chars.</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="stringliteral">    @param lastbytes The number of bytes at the end of the file to check.</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="stringliteral">        Can be larger than the file size.</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="stringliteral">    @param logger A logging.Logger for log messages.</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="stringliteral">    @returns True if the file contains the given string, False otherwise&quot;&quot;&quot;</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    with open(str(filename),<span class="stringliteral">&#39;rt&#39;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            f.seek(-lastbytes,os.SEEK_END)</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;        <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                logger.info(<span class="stringliteral">&#39;%s: probably not an error: %s&#39;</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                            %(filename,str(e)))</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        i=0</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="keywordflow">for</span> line <span class="keywordflow">in</span> f:</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            i+=1</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            <span class="comment">#print &#39;%s: search line &quot;%s&quot; for &quot;%s&quot;&#39;%(</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            <span class="comment">#               filename,line,searchstr)</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <span class="keywordflow">if</span> line.find(searchstr)&gt;=0:</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            logger.info(<span class="stringliteral">&#39;%s: read %d lines&#39;</span>%(filename,i))</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">########################################################################</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#ab72fa381de5b4edd17522d539593385b">check_file</a>(filename,min_size=None,min_mtime_age=None,</div><div class="line"><a name="l00929"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#ab72fa381de5b4edd17522d539593385b">  929</a></span>&#160;               min_atime_age=None,min_ctime_age=None,logger=None):</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Determines whether the specified file exists, and meets</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="stringliteral">    additional requirements.</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="stringliteral">    @param filename The file to analyze.</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="stringliteral">    @param min_size If present, the file must be at least this many bytes.</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="stringliteral">    @param min_mtime_age If specified, the file must have been modified</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="stringliteral">        more than this many seconds in the past.</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="stringliteral">    @param min_atime_age if specified, the file atime must be at least</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="stringliteral">        this many seconds old.  The meaning of atime varies, but</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="stringliteral">        usually means the last access time.</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="stringliteral">    @param min_ctime_age If specified, the file ctime must be at least</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="stringliteral">        this many seconds old.  The meaning of ctime varies between</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="stringliteral">        platforms and file types, but usually means the file creation</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="stringliteral">        or inode change time.  See stat(2) for details.</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="stringliteral">    @param logger a logging.Logger for log messages.</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="stringliteral">    @note This routine can also be used on directories, but one should avoid</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="stringliteral">    the min_size option when doing that.</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="stringliteral">    @returns True if requirements are met, False otherwise.    &quot;&quot;&quot;</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        s=os.stat(filename)</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordflow">if</span> s.st_size&lt;min_size: </div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                logger.info(<span class="stringliteral">&#39;%s: too small&#39;</span>%(filename,))</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keywordflow">if</span> min_mtime_age <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> min_atime_age <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> \</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                <span class="keywordflow">or</span> min_ctime_age <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            now=int(time.time())</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            <span class="keywordflow">if</span> min_mtime_age <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> now-s.st_mtime&gt;min_mtime_age: </div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                    <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                        logger.info(<span class="stringliteral">&#39;%s: not old enough (modification time)&#39;</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                                    %(filename,))</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <span class="keywordflow">if</span> min_atime_age <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> now-s.st_atime&gt;min_atime_age: </div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                    <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                        logger.info(<span class="stringliteral">&#39;%s: not old enough (access time)&#39;</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                    %(filename,))</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            <span class="keywordflow">if</span> min_ctime_age <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> now-s.st_ctime&gt;min_ctime_age: </div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                    <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                        logger.info(<span class="stringliteral">&#39;%s: not old enough (inode change time)&#39;</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                                    %(filename,))</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            logger.info(<span class="stringliteral">&#39;%s: file meets requirements&#39;</span>%(filename,))</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">except</span> EnvironmentError <span class="keyword">as</span> e:</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        <span class="keywordflow">if</span> e.errno==errno.ENOENT:</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                logger.info(<span class="stringliteral">&#39;%s: does not exist (ENOENT)&#39;</span>%(filename,))</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <span class="keywordflow">raise</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html">  984</a></span>&#160;<span class="keyword">class </span><a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html">FileWaiter</a>:</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!A class that waits for files to meet some requirements.&quot;&quot;&quot;</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a20637a4ad131227400cebaa980d8c5eb">__init__</a>(self,flist=None,min_size=None,</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                 min_mtime_age=None,min_atime_age=None,</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                 min_ctime_age=None,</div><div class="line"><a name="l00989"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a20637a4ad131227400cebaa980d8c5eb">  989</a></span>&#160;                 min_fraction=1.0):</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Constructor for the FileWaiter.  Most arguments have the same</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="stringliteral">        meaning as check_file()</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="stringliteral">        @param flist the file or list of files to wait for.  This is simply</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="stringliteral">              sent into self.add.</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="stringliteral">        @param min_size minimum file size</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="stringliteral">        @param min_mtime_age minimum modification time age, </span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="stringliteral">        @param min_atime_age minimum access time age.</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="stringliteral">        @param min_ctime_age time since last file status change (see stat(2))</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="stringliteral">        @param min_fraction the minimum fraction of the provided files</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="stringliteral">            that must match the above requirements in order for</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="stringliteral">            FileWaiter.wait to return True. Default is 1.0, which</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="stringliteral">            means all of them.&quot;&quot;&quot;</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a34d6148a43f82c91004dc3c1c747ea75">_flist</a>=list()</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">_fset</a>=set()</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>=set()</div><div class="line"><a name="l01005"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a8f3ba5a9be034cdd49fd1cab50b1f168"> 1005</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a8f3ba5a9be034cdd49fd1cab50b1f168">min_size</a>=min_size</div><div class="line"><a name="l01006"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a8bbc7c7ac17ec2561fe1c9014a1efff0"> 1006</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a8bbc7c7ac17ec2561fe1c9014a1efff0">min_mtime_age</a>=min_mtime_age</div><div class="line"><a name="l01007"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a23b0a463ca4f94925159790278bebc54"> 1007</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a23b0a463ca4f94925159790278bebc54">min_atime_age</a>=min_atime_age</div><div class="line"><a name="l01008"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a7bd23049dd8fadf1173debe9a5efa3c2"> 1008</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a7bd23049dd8fadf1173debe9a5efa3c2">min_ctime_age</a>=min_ctime_age</div><div class="line"><a name="l01009"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#af7cecf741973d5540a2557727d109ba7"> 1009</a></span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#af7cecf741973d5540a2557727d109ba7">min_fraction</a>=float(min_fraction)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordflow">if</span> flist <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>: self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a0375cc529c0a08aa352ce6a6f2663db2">add</a>(flist)</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;    <span class="comment">##@var min_size</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">    # The minimum file size</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    <span class="comment">##@var min_mtime_age</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">    # Minimum age of the modification time</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="comment">##@var min_atime_age</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">    # Minimum age of the access time</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="comment">##@var min_ctime_age</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">    # Minimum age of the creation and/or inode access time</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="comment">##@var min_fraction</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">    # The minimum fraction of files that must meet the requirements</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a0375cc529c0a08aa352ce6a6f2663db2"> 1026</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a0375cc529c0a08aa352ce6a6f2663db2">add</a>(self,flist):</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Adds a file, or iterable that iterates over files, to the</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="stringliteral">        list of files to wait for.  If the same filename is received a</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="stringliteral">        second time, it is ignored.</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="stringliteral">        @param flist a filename (string) or list of filenames&quot;&quot;&quot;</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        <span class="keywordflow">if</span> isinstance(flist,str):</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            <span class="keywordflow">if</span> flist <span class="keywordflow">in</span> self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">_fset</a>:</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                <span class="keywordflow">return</span> <span class="comment"># already have this file</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a34d6148a43f82c91004dc3c1c747ea75">_flist</a>.append(flist)</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">_fset</a>.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a0375cc529c0a08aa352ce6a6f2663db2">add</a>(flist)</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <span class="keywordflow">for</span> file <span class="keywordflow">in</span> flist:</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a0375cc529c0a08aa352ce6a6f2663db2">add</a>(file)</div><div class="line"><a name="l01039"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a34a77c830bf6c00193a563a0d96a63f4"> 1039</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a34a77c830bf6c00193a563a0d96a63f4">check</a>(self,filename,logger=None):</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Checks to see if one file meets the requirements set in the</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="stringliteral">        constructor.  This default implementation calls check_file.</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="stringliteral">        This is in a separate member function so that a subclass can</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="stringliteral">        override the file checking method.  </span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="stringliteral">        @returns True if the file is &quot;ready,&quot; and False if it is not.</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="stringliteral">        @param filename the path to the file to check</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="stringliteral">        @param logger a logging.Logger for messages&quot;&quot;&quot;</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespaceprodutil_1_1fileop.html#ab72fa381de5b4edd17522d539593385b">check_file</a>(filename,self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a8f3ba5a9be034cdd49fd1cab50b1f168">min_size</a>,self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a8bbc7c7ac17ec2561fe1c9014a1efff0">min_mtime_age</a>,</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                          self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a23b0a463ca4f94925159790278bebc54">min_atime_age</a>,self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a7bd23049dd8fadf1173debe9a5efa3c2">min_ctime_age</a>,</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                          logger=logger)</div><div class="line"><a name="l01050"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a3af3befea0ee1484aa06974c4e8fd56b"> 1050</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a3af3befea0ee1484aa06974c4e8fd56b">reset</a>(self):</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Resets internal information about which files have been</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="stringliteral">        seen.&quot;&quot;&quot;</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>=set()</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        </div><div class="line"><a name="l01055"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a1a36ef446bdb6f77450dfa14a9a67e35"> 1055</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a1a36ef446bdb6f77450dfa14a9a67e35">iterfound</a>(self):</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Iterates over all files that were found.&quot;&quot;&quot;</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keywordflow">for</span> filename <span class="keywordflow">in</span> self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>: <span class="keywordflow">yield</span> filename</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#adc17c0cca5b4d3ddc6b91ec91990eb1d"> 1059</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#adc17c0cca5b4d3ddc6b91ec91990eb1d">countfound</a>(self):</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Returns the number of files that were found.&quot;&quot;&quot;</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        <span class="keywordflow">return</span> len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>)</div><div class="line"><a name="l01062"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a4b2bd926e871d88b141c5ecec58dd413"> 1062</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a4b2bd926e871d88b141c5ecec58dd413">countmissing</a>(self):</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Returns the number of files that were NOT found.&quot;&quot;&quot;</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <span class="keywordflow">return</span> len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">_fset</a>)-len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>)</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="keyword">def </span><a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a52d22d5bf5aba029de8567ded1151c5c">checkfiles</a>(self,maxwait=1800,sleeptime=20,logger=None,</div><div class="line"><a name="l01067"></a><span class="lineno"><a class="line" href="classprodutil_1_1fileop_1_1FileWaiter.html#a52d22d5bf5aba029de8567ded1151c5c"> 1067</a></span>&#160;                   log_each_file=True):</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;!Looks for the requested files.  Will loop, checking over</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="stringliteral">        and over up to maxwait seconds, sleeping sleeptime seconds</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="stringliteral">        between checks.</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="stringliteral">        @param maxwait maximum seconds to wait</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="stringliteral">        @param sleeptime sleep time in seconds between checks</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="stringliteral">        @param logger a logging.Logger for messages</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="stringliteral">        @param log_each_file log messages about each file checked&quot;&quot;&quot;</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        maxwait=int(maxwait)</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        start=int(time.time())</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        now=start</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        first=<span class="keyword">True</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="keywordflow">if</span> log_each_file:</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            flogger=logger</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            flogger=<span class="keywordtype">None</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        <span class="keywordflow">while</span> <span class="keywordtype">None</span> <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            <span class="keywordflow">if</span> len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">_fset</a>)&lt;=0: </div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                    logger.info(<span class="stringliteral">&#39;No files to check.&#39;</span>)</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            left=len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">_fset</a>)-len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>)</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            now=int(time.time())</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            nfiles=len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">_fset</a>)</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            nfound=len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>)</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            frac=float(nfound)/nfiles</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            needfiles=math.ceil(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#af7cecf741973d5540a2557727d109ba7">min_fraction</a>*nfiles)</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            <span class="keywordflow">if</span> frac&gt;=self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#af7cecf741973d5540a2557727d109ba7">min_fraction</a>-1e-5: </div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                logger.info(<span class="stringliteral">&#39;Have required fraction of files.&#39;</span>)</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            <span class="keywordflow">if</span> now-start&gt;=maxwait: </div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                logger.info(<span class="stringliteral">&#39;Waited too long.  Giving up.&#39;</span>)</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            </div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> first:</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                sleepnow=max(0,min(sleeptime,start+maxwait-now-1))</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                <span class="keywordflow">if</span> sleepnow&lt;1e-3:</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                    logger.info(<span class="stringliteral">&#39;Waited too long.  Giving up.&#39;</span>)</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                    logger.info(<span class="stringliteral">&#39;Still need files: have %d of %d, &#39;</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                                <span class="stringliteral">&#39;but need %g%% of them (%g file%s).&#39;</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                                %(len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>),len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">_fset</a>),</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                                  self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#af7cecf741973d5540a2557727d109ba7">min_fraction</a>*100.0,needfiles,</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                                  <span class="stringliteral">&#39;s&#39;</span> <span class="keywordflow">if</span> (needfiles&gt;1) <span class="keywordflow">else</span> <span class="stringliteral">&#39;&#39;</span>))</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                    logfun=logger.info <span class="keywordflow">if</span> (sleepnow&gt;=5) <span class="keywordflow">else</span> logger.debug</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                    logfun(<span class="stringliteral">&#39;Sleeping %g seconds...&#39;</span>%(float(sleepnow),))</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                time.sleep(sleepnow)</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                <span class="keywordflow">if</span> logger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                    logfun(<span class="stringliteral">&#39;Done sleeping.&#39;</span>)</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            first=<span class="keyword">False</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            <span class="keywordflow">for</span> filename <span class="keywordflow">in</span> self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a34d6148a43f82c91004dc3c1c747ea75">_flist</a>:</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                <span class="keywordflow">if</span> filename <span class="keywordflow">in</span> self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>: <span class="keywordflow">continue</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a34a77c830bf6c00193a563a0d96a63f4">check</a>(filename,logger=flogger):</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                    self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#a0375cc529c0a08aa352ce6a6f2663db2">add</a>(filename)</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                    <span class="keywordflow">if</span> flogger <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                        flogger.info(<span class="stringliteral">&#39;%s: found this one (%d of %d found).&#39;</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                                    %(filename,len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>),</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                                      len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">_fset</a>)))</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                </div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="keywordflow">return</span> len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">_found</a>)&gt;=len(self.<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">_fset</a>)</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="keyword">def </span><a class="code" href="namespaceprodutil_1_1fileop.html#a3de5b479cd788eaa151fc79c52f76a54">wait_for_files</a>(flist,logger=None,maxwait=1800,sleeptime=20,</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                   min_size=1,min_mtime_age=30,min_atime_age=None,</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                   min_ctime_age=None,min_fraction=1.0,</div><div class="line"><a name="l01136"></a><span class="lineno"><a class="line" href="namespaceprodutil_1_1fileop.html#a3de5b479cd788eaa151fc79c52f76a54"> 1136</a></span>&#160;                   log_each_file=True):</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;!Waits for files to meet requirements.  This is a simple</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="stringliteral">    wrapper around the FileWaiter class for convenience.  It is</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="stringliteral">    equivalent to creating a FileWaiter with the provided arguments,</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="stringliteral">    and calling its checkfiles routine.</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="stringliteral">        @param flist the file or list of files to wait for.  This is simply</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="stringliteral">              sent into self.add.</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="stringliteral">        @param logger a logging.Logger for messages</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="stringliteral">        @param maxwait maximum seconds to wait</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="stringliteral">        @param sleeptime sleep time in seconds between checks</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="stringliteral">        @param min_size minimum file size</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="stringliteral">        @param min_mtime_age minimum modification time age, </span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="stringliteral">        @param min_atime_age minimum access time age.</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="stringliteral">        @param min_ctime_age time since last file status change (see stat(2))</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="stringliteral">        @param min_fraction the minimum fraction of the provided files</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="stringliteral">            that must match the above requirements in order for</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="stringliteral">            FileWaiter.wait to return True. Default is 1.0, which</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="stringliteral">            means all of them.</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="stringliteral">        @param log_each_file log messages about each file checked  &quot;&quot;&quot;</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    waiter=<a class="code" href="classprodutil_1_1fileop_1_1FileWaiter.html">FileWaiter</a>(flist,min_size,min_mtime_age,min_atime_age,</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                      min_ctime_age,min_fraction)</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">return</span> waiter.checkfiles(maxwait,sleeptime,logger,log_each_file)</div><div class="ttc" id="classprodutil_1_1fileop_1_1CannotLinkMulti_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1CannotLinkMulti.html">produtil.fileop.CannotLinkMulti</a></div><div class="ttdoc">This exception is raised when the caller tries to create multiple symlinks in a single target...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00062">fileop.py:62</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a2fd8f9c1342cfe0a7f827cb6e6b16980"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a2fd8f9c1342cfe0a7f827cb6e6b16980">produtil.fileop.netcdfver</a></div><div class="ttdeci">def netcdfver(filename)</div><div class="ttdoc">What is the NetCDF version of this file? </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00176">fileop.py:176</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a82b5e696cfbd8f4c4ed72c9d37f34e18"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a82b5e696cfbd8f4c4ed72c9d37f34e18">produtil.fileop.makedirs</a></div><div class="ttdeci">def makedirs(filename, numtries=10, logger=None)</div><div class="ttdoc">Make a directory tree, working around filesystem bugs. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00223">fileop.py:223</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_af7cecf741973d5540a2557727d109ba7"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#af7cecf741973d5540a2557727d109ba7">produtil.fileop.FileWaiter.min_fraction</a></div><div class="ttdeci">min_fraction</div><div class="ttdoc">The minimum fraction of files that must meet the requirements. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01009">fileop.py:1009</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_ac56ac21b38401c2c8dc23191f13a58ae"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#ac56ac21b38401c2c8dc23191f13a58ae">produtil.fileop.make_symlink</a></div><div class="ttdeci">def make_symlink(source, target, force=False, logger=None, max_tries=20)</div><div class="ttdoc">Creates a symbolic link &quot;target&quot; that points to &quot;source&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00666">fileop.py:666</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1VerificationFailed_html_aebdce07771218b4e20d0feaf9285d9f4"><div class="ttname"><a href="classprodutil_1_1fileop_1_1VerificationFailed.html#aebdce07771218b4e20d0feaf9285d9f4">produtil.fileop.VerificationFailed.verifyfile</a></div><div class="ttdeci">verifyfile</div><div class="ttdoc">The file to verify. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00125">fileop.py:125</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_ade91f28b05a8489a0ee7a5d648f0c6b9"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#ade91f28b05a8489a0ee7a5d648f0c6b9">produtil.fileop.touch</a></div><div class="ttdeci">def touch(filename, times=None)</div><div class="ttdoc">Open the file for append and set mtime and atime. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00163">fileop.py:163</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a20637a4ad131227400cebaa980d8c5eb"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a20637a4ad131227400cebaa980d8c5eb">produtil.fileop.FileWaiter.__init__</a></div><div class="ttdeci">def __init__(self, flist=None, min_size=None, min_mtime_age=None, min_atime_age=None, min_ctime_age=None, min_fraction=1.0)</div><div class="ttdoc">Constructor for the FileWaiter. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00989">fileop.py:989</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a52d22d5bf5aba029de8567ded1151c5c"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a52d22d5bf5aba029de8567ded1151c5c">produtil.fileop.FileWaiter.checkfiles</a></div><div class="ttdeci">def checkfiles(self, maxwait=1800, sleeptime=20, logger=None, log_each_file=True)</div><div class="ttdoc">Looks for the requested files. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01067">fileop.py:1067</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a69d760bd1b5509d046f806001866466b"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a69d760bd1b5509d046f806001866466b">produtil.fileop.unblock</a></div><div class="ttdeci">def unblock(stream, logger=None)</div><div class="ttdoc">Attempts to modify the given stream to be non-blocking. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00736">fileop.py:736</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileOpError_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileOpError.html">produtil.fileop.FileOpError</a></div><div class="ttdoc">This is the superclass of several exceptions relating to multi-file operations in produtil...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00026">fileop.py:26</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_adb7573cdfc47dc6e628f464d7371b246"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#adb7573cdfc47dc6e628f464d7371b246">produtil.fileop.replace_symlink</a></div><div class="ttdeci">def replace_symlink(source, target, logger=None, max_tries=20)</div><div class="ttdoc">Do not call this routine directly: you want make_symlink instead. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00700">fileop.py:700</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a8c8cfc6d9254517b452181daa7b594cb"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a8c8cfc6d9254517b452181daa7b594cb">produtil.fileop.deliver_file</a></div><div class="ttdeci">def deliver_file(infile, outfile, keep=True, verify=False, blocksize=1048576, tempprefix=None, permmask=0o002, removefailed=True, logger=None, preserve_perms=True, preserve_times=True, preserve_group=None, copy_acl=None, moveok=True, force=True, copier=None)</div><div class="ttdoc">This moves or copies the file &quot;infile&quot; to &quot;outfile&quot; in a unit operation; outfile will never be seen i...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00348">fileop.py:348</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a5b700e0da6a39676498832a268418628"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a5b700e0da6a39676498832a268418628">produtil.fileop.chdir</a></div><div class="ttdeci">def chdir(path, logger=None)</div><div class="ttdoc">Changes to the specified directory. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00144">fileop.py:144</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FindExeInvalidExeName_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FindExeInvalidExeName.html">produtil.fileop.FindExeInvalidExeName</a></div><div class="ttdoc">Thrown when find_exe is given an executable name that contains a directory path. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00071">fileop.py:71</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1UnexpectedAbsolutePath_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1UnexpectedAbsolutePath.html">produtil.fileop.UnexpectedAbsolutePath</a></div><div class="ttdoc">This exception indicates that the renamer function sent to make_symlinks_in returned an absolute path...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00066">fileop.py:66</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a29aad92d8a2f44c49b9358c3166a9d04"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a29aad92d8a2f44c49b9358c3166a9d04">produtil.fileop.fortlink</a></div><div class="ttdeci">def fortlink(forts, force=False, basedir=None, logger=None)</div><div class="ttdoc">This is a convenience routine that makes many symbolic links to fort.N files for various integers N u...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00781">fileop.py:781</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_ab6cbd82df08e703850cd97edfbda5e18"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#ab6cbd82df08e703850cd97edfbda5e18">produtil.fileop.FileWaiter._found</a></div><div class="ttdeci">_found</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01004">fileop.py:1004</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a8a3633e9dc781dd59dc362fe65d915cd"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a8a3633e9dc781dd59dc362fe65d915cd">produtil.fileop.norm_abs_path</a></div><div class="ttdeci">def norm_abs_path(rel, fromdir=None)</div><div class="ttdoc">Return relative path. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00881">fileop.py:881</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a50459c609937539cd23961fac5245770"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a50459c609937539cd23961fac5245770">produtil.fileop.fortcopy</a></div><div class="ttdeci">def fortcopy(forts, basedir=None, logger=None, only_log_errors=False, kwargs)</div><div class="ttdoc">A convenience function for copying files to local fort.N files for various integers N using deliver_f...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00815">fileop.py:815</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileOpErrors_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileOpErrors.html">produtil.fileop.FileOpErrors</a></div><div class="ttdoc">This exception is raised when an operation that processes multiple files catches more than one except...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00059">fileop.py:59</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileOpError_html_aef86d7687a32ff0310e2a1dd4529eb82"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileOpError.html#aef86d7687a32ff0310e2a1dd4529eb82">produtil.fileop.FileOpError.message</a></div><div class="ttdeci">message</div><div class="ttdoc">The error message. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00036">fileop.py:36</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1cluster_html_aa06e2671512c276fcee1dd7c441a7f98"><div class="ttname"><a href="namespaceprodutil_1_1cluster.html#aa06e2671512c276fcee1dd7c441a7f98">produtil.cluster.use_acl_for_rstdata</a></div><div class="ttdeci">def use_acl_for_rstdata()</div><div class="ttdoc">Synonym for here.use_acl_for_rstdata. </div><div class="ttdef"><b>Definition:</b> <a href="cluster_8py_source.html#l00147">cluster.py:147</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a3af3befea0ee1484aa06974c4e8fd56b"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a3af3befea0ee1484aa06974c4e8fd56b">produtil.fileop.FileWaiter.reset</a></div><div class="ttdeci">def reset(self)</div><div class="ttdoc">Resets internal information about which files have been seen. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01050">fileop.py:1050</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_ab40f65aa984bb2e3fdf5a45803e4a51a"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#ab40f65aa984bb2e3fdf5a45803e4a51a">produtil.fileop.gribver</a></div><div class="ttdeci">def gribver(filename)</div><div class="ttdoc">What is the GRIB version of this file? </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00200">fileop.py:200</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1DeliveryFailed_html_a5d547c2c860f6031087f47fed33fa0c3"><div class="ttname"><a href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a5d547c2c860f6031087f47fed33fa0c3">produtil.fileop.DeliveryFailed.message</a></div><div class="ttdeci">message</div><div class="ttdoc">String description of the problem. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00094">fileop.py:94</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a34d6148a43f82c91004dc3c1c747ea75"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a34d6148a43f82c91004dc3c1c747ea75">produtil.fileop.FileWaiter._flist</a></div><div class="ttdeci">_flist</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01002">fileop.py:1002</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a306d0b77df75fde3f04e77c51c3b0abb"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a306d0b77df75fde3f04e77c51c3b0abb">produtil.fileop.isnonempty</a></div><div class="ttdeci">def isnonempty(filename)</div><div class="ttdoc">Returns True if the filename refers to an existent file that is non-empty, and False otherwise...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00332">fileop.py:332</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1CannotFindExe_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1CannotFindExe.html">produtil.fileop.CannotFindExe</a></div><div class="ttdoc">Thrown when find_exe cannot find an executable in the path or directory list. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00074">fileop.py:74</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a1c2c05b48921c3397b98c51e8ae71238"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a1c2c05b48921c3397b98c51e8ae71238">produtil.fileop.check_last_lines</a></div><div class="ttdeci">def check_last_lines(filename, searchstr, lastbytes=10000, logger=None)</div><div class="ttdoc">Checks the last few bytes of a file to see if the specified search string is present. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00895">fileop.py:895</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_ad7b3ccb99913d2bedcaabf98c58e6dd8"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#ad7b3ccb99913d2bedcaabf98c58e6dd8">produtil.fileop.remove_file</a></div><div class="ttdeci">def remove_file(filename, info=True, logger=None)</div><div class="ttdoc">Deletes the specified file. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00250">fileop.py:250</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1VerificationFailed_html_ab3a0b9e1bafa03f9721b027f61f24ee9"><div class="ttname"><a href="classprodutil_1_1fileop_1_1VerificationFailed.html#ab3a0b9e1bafa03f9721b027f61f24ee9">produtil.fileop.VerificationFailed.__init__</a></div><div class="ttdeci">def __init__(self, message, fromfile, tofile, verifyfile)</div><div class="ttdoc">VerificationFailed constructor. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00118">fileop.py:118</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1cluster_html"><div class="ttname"><a href="namespaceprodutil_1_1cluster.html">produtil.cluster</a></div><div class="ttdoc">Provides information about the cluster on which this job is running. </div><div class="ttdef"><b>Definition:</b> <a href="cluster_8py_source.html#l00001">cluster.py:1</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1DeliveryFailed_html_aada16d988676d50769c3e0dd94206d24"><div class="ttname"><a href="classprodutil_1_1fileop_1_1DeliveryFailed.html#aada16d988676d50769c3e0dd94206d24">produtil.fileop.DeliveryFailed.tofile</a></div><div class="ttdeci">tofile</div><div class="ttdoc">The target file. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00096">fileop.py:96</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_aa52fce11dc21c8c18bcb07e8b3b25cf9"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#aa52fce11dc21c8c18bcb07e8b3b25cf9">produtil.fileop.FileWaiter._fset</a></div><div class="ttdeci">_fset</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01003">fileop.py:1003</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_ab72fa381de5b4edd17522d539593385b"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#ab72fa381de5b4edd17522d539593385b">produtil.fileop.check_file</a></div><div class="ttdeci">def check_file(filename, min_size=None, min_mtime_age=None, min_atime_age=None, min_ctime_age=None, logger=None)</div><div class="ttdoc">Determines whether the specified file exists, and meets additional requirements. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00929">fileop.py:929</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1VerificationFailed_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1VerificationFailed.html">produtil.fileop.VerificationFailed</a></div><div class="ttdoc">This exception is raised when a copy of a file has different content than the original. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00115">fileop.py:115</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1WrongSymlink_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1WrongSymlink.html">produtil.fileop.WrongSymlink</a></div><div class="ttdoc">Raised when os.symlink makes a symlink to a target other than the one that was requested. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00081">fileop.py:81</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1DeliveryFailed_html_aa116bcb469841c7730a2c192c5105338"><div class="ttname"><a href="classprodutil_1_1fileop_1_1DeliveryFailed.html#aa116bcb469841c7730a2c192c5105338">produtil.fileop.DeliveryFailed.__init__</a></div><div class="ttdeci">def __init__(self, message, fromfile, tofile)</div><div class="ttdoc">DeliveryFailed constructor. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00089">fileop.py:89</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a4b2bd926e871d88b141c5ecec58dd413"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a4b2bd926e871d88b141c5ecec58dd413">produtil.fileop.FileWaiter.countmissing</a></div><div class="ttdeci">def countmissing(self)</div><div class="ttdoc">Returns the number of files that were NOT found. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01062">fileop.py:1062</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a4ac1bf31c05016a535219e6a96cf7740"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a4ac1bf31c05016a535219e6a96cf7740">produtil.fileop.make_symlinks_in</a></div><div class="ttdeci">def make_symlinks_in(sources, targetdir, force=False, renamer=None, logger=None, copy=False)</div><div class="ttdoc">Creates symbolic links from a set of source files to a target directory. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00609">fileop.py:609</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileOpError_html_a63a850fb46a0a9fcfdb095726ff244fa"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileOpError.html#a63a850fb46a0a9fcfdb095726ff244fa">produtil.fileop.FileOpError.__init__</a></div><div class="ttdeci">def __init__(self, message, filename, more=[])</div><div class="ttdoc">FileOpError constructor. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00029">fileop.py:29</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1VerificationFailed_html_ae605b37f98840c374775e3c32e495d4d"><div class="ttname"><a href="classprodutil_1_1fileop_1_1VerificationFailed.html#ae605b37f98840c374775e3c32e495d4d">produtil.fileop.VerificationFailed.__repr__</a></div><div class="ttdeci">def __repr__(self)</div><div class="ttdoc">Pythonic representation of this error. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00133">fileop.py:133</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1DeliveryFailed_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1DeliveryFailed.html">produtil.fileop.DeliveryFailed</a></div><div class="ttdoc">This exception is raised when a file cannot be delivered. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00087">fileop.py:87</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a34a77c830bf6c00193a563a0d96a63f4"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a34a77c830bf6c00193a563a0d96a63f4">produtil.fileop.FileWaiter.check</a></div><div class="ttdeci">def check(self, filename, logger=None)</div><div class="ttdoc">Checks to see if one file meets the requirements set in the constructor. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01039">fileop.py:1039</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileOpError_html_a3047a635cbdec034ac5c7d5048af5899"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileOpError.html#a3047a635cbdec034ac5c7d5048af5899">produtil.fileop.FileOpError.more</a></div><div class="ttdeci">more</div><div class="ttdoc">A list of tuples, (from,to,message) where from is the source file, to is the destination file and mes...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00038">fileop.py:38</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1InvalidExecutable_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1InvalidExecutable.html">produtil.fileop.InvalidExecutable</a></div><div class="ttdoc">Thrown when a find_exe fails. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00069">fileop.py:69</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1VerificationFailed_html_ad4db0e82790c06f70b8c78abf98e88b4"><div class="ttname"><a href="classprodutil_1_1fileop_1_1VerificationFailed.html#ad4db0e82790c06f70b8c78abf98e88b4">produtil.fileop.VerificationFailed.__str__</a></div><div class="ttdeci">def __str__(self)</div><div class="ttdoc">Human-readable description of this error. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00129">fileop.py:129</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileOpError_html_a18cf7a0178abf6e6cdd4116ad0e87e83"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileOpError.html#a18cf7a0178abf6e6cdd4116ad0e87e83">produtil.fileop.FileOpError.__str__</a></div><div class="ttdeci">def __str__(self)</div><div class="ttdoc">A string description of the problem. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00050">fileop.py:50</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1RelativePathError_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1RelativePathError.html">produtil.fileop.RelativePathError</a></div><div class="ttdoc">Raised when a relative path is given, but an absolute path is expected. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00077">fileop.py:77</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileOpError_html_ab65372c3f15d2df0dbce8c3bbbdbe3f2"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileOpError.html#ab65372c3f15d2df0dbce8c3bbbdbe3f2">produtil.fileop.FileOpError.__iter__</a></div><div class="ttdeci">def __iter__(self)</div><div class="ttdoc">Iterates over a list of tuples, (from,to,message) where from is the source file, to is the destinatio...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00053">fileop.py:53</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_adc17c0cca5b4d3ddc6b91ec91990eb1d"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#adc17c0cca5b4d3ddc6b91ec91990eb1d">produtil.fileop.FileWaiter.countfound</a></div><div class="ttdeci">def countfound(self)</div><div class="ttdoc">Returns the number of files that were found. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01059">fileop.py:1059</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a3de5b479cd788eaa151fc79c52f76a54"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a3de5b479cd788eaa151fc79c52f76a54">produtil.fileop.wait_for_files</a></div><div class="ttdeci">def wait_for_files(flist, logger=None, maxwait=1800, sleeptime=20, min_size=1, min_mtime_age=30, min_atime_age=None, min_ctime_age=None, min_fraction=1.0, log_each_file=True)</div><div class="ttdoc">Waits for files to meet requirements. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01136">fileop.py:1136</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a8f3ba5a9be034cdd49fd1cab50b1f168"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a8f3ba5a9be034cdd49fd1cab50b1f168">produtil.fileop.FileWaiter.min_size</a></div><div class="ttdeci">min_size</div><div class="ttdoc">The minimum file size. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01005">fileop.py:1005</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1cluster_html_abc32f04e267a14ae8707ed672f7373fc"><div class="ttname"><a href="namespaceprodutil_1_1cluster.html#abc32f04e267a14ae8707ed672f7373fc">produtil.cluster.group_quotas</a></div><div class="ttdeci">def group_quotas()</div><div class="ttdoc">Synonym for here.group_quotas. </div><div class="ttdef"><b>Definition:</b> <a href="cluster_8py_source.html#l00128">cluster.py:128</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1DeliveryFailed_html_a50fea4b7bb0919d0c0a4e91cf94ae583"><div class="ttname"><a href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a50fea4b7bb0919d0c0a4e91cf94ae583">produtil.fileop.DeliveryFailed.fromfile</a></div><div class="ttdeci">fromfile</div><div class="ttdoc">The source file. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00095">fileop.py:95</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_ab3398b00c8d1f23691dafa4972070a2d"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#ab3398b00c8d1f23691dafa4972070a2d">produtil.fileop.norm_expand_path</a></div><div class="ttdeci">def norm_expand_path(path=None, fullnorm=False)</div><div class="ttdoc">Normalizes path and expand home directories. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00857">fileop.py:857</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a23b0a463ca4f94925159790278bebc54"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a23b0a463ca4f94925159790278bebc54">produtil.fileop.FileWaiter.min_atime_age</a></div><div class="ttdeci">min_atime_age</div><div class="ttdoc">Minimum age of the access time. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01007">fileop.py:1007</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileOpError_html_a948b57d6ba76e2a11506d93c1b574999"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileOpError.html#a948b57d6ba76e2a11506d93c1b574999">produtil.fileop.FileOpError.filename</a></div><div class="ttdeci">filename</div><div class="ttdoc">The name of the problematic file. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00037">fileop.py:37</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_aa520f12ba7897ddfa1ab2894de7ebd64"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#aa520f12ba7897ddfa1ab2894de7ebd64">produtil.fileop.find_exe</a></div><div class="ttdeci">def find_exe(name, dirlist=None, raise_missing=True)</div><div class="ttdoc">Searches the $PATH or a specified iterable of directory names to find an executable file with the giv...</div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00562">fileop.py:562</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a7e01f7ab110986c9c031a54f48dbb626"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a7e01f7ab110986c9c031a54f48dbb626">produtil.fileop.call_fcntrl</a></div><div class="ttdeci">def call_fcntrl(stream, on, off, logger=None)</div><div class="ttdoc">Internal function that implements unblock() </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00751">fileop.py:751</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_acbb763446440b42b162566b0821b8212"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#acbb763446440b42b162566b0821b8212">produtil.fileop.realcwd</a></div><div class="ttdeci">def realcwd()</div><div class="ttdoc">Returns the current working directory, expanding any symbolic links. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00139">fileop.py:139</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a9939944f5ea130c4557a137206abcec6"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a9939944f5ea130c4557a137206abcec6">produtil.fileop.rmall</a></div><div class="ttdeci">def rmall(args, kwargs)</div><div class="ttdoc">Deletes the specified list of files. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00275">fileop.py:275</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html">produtil.fileop.FileWaiter</a></div><div class="ttdoc">A class that waits for files to meet some requirements. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00984">fileop.py:984</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1pipeline_html"><div class="ttname"><a href="namespaceprodutil_1_1pipeline.html">produtil.pipeline</a></div><div class="ttdoc">Internal module that launches and monitors processes. </div><div class="ttdef"><b>Definition:</b> <a href="pipeline_8py_source.html#l00001">pipeline.py:1</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a89943b625d848173605fa3b8578d9ed1"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a89943b625d848173605fa3b8578d9ed1">produtil.fileop.lstat_stat</a></div><div class="ttdeci">def lstat_stat(filename, raise_nonexist=False)</div><div class="ttdoc">Runs lstat and stat on a file as efficiently as possible. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00306">fileop.py:306</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1DeliveryFailed_html_a0190de016de397b3f077c4c99b160d77"><div class="ttname"><a href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a0190de016de397b3f077c4c99b160d77">produtil.fileop.DeliveryFailed.__str__</a></div><div class="ttdeci">def __str__(self)</div><div class="ttdoc">Human-readable description of this error. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00106">fileop.py:106</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a0375cc529c0a08aa352ce6a6f2663db2"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a0375cc529c0a08aa352ce6a6f2663db2">produtil.fileop.FileWaiter.add</a></div><div class="ttdeci">def add(self, flist)</div><div class="ttdoc">Adds a file, or iterable that iterates over files, to the list of files to wait for. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01026">fileop.py:1026</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1DeliveryFailed_html_a5f2b48e2f2f95216a243c5d15d13d627"><div class="ttname"><a href="classprodutil_1_1fileop_1_1DeliveryFailed.html#a5f2b48e2f2f95216a243c5d15d13d627">produtil.fileop.DeliveryFailed.__repr__</a></div><div class="ttdeci">def __repr__(self)</div><div class="ttdoc">Pythonic representation of this error. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00110">fileop.py:110</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a1a36ef446bdb6f77450dfa14a9a67e35"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a1a36ef446bdb6f77450dfa14a9a67e35">produtil.fileop.FileWaiter.iterfound</a></div><div class="ttdeci">def iterfound(self)</div><div class="ttdoc">Iterates over all files that were found. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01055">fileop.py:1055</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a8bbc7c7ac17ec2561fe1c9014a1efff0"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a8bbc7c7ac17ec2561fe1c9014a1efff0">produtil.fileop.FileWaiter.min_mtime_age</a></div><div class="ttdeci">min_mtime_age</div><div class="ttdoc">Minimum age of the modification time. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01006">fileop.py:1006</a></div></div>
<div class="ttc" id="namespaceprodutil_1_1fileop_html_a5fab248eba83d35a1c45ababa9dc3a23"><div class="ttname"><a href="namespaceprodutil_1_1fileop.html#a5fab248eba83d35a1c45ababa9dc3a23">produtil.fileop.symlink_read_test</a></div><div class="ttdeci">def symlink_read_test(filename, readsize=40, logger=None)</div><div class="ttdoc">Opens the specified file for reading and attempts to read data to it. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l00593">fileop.py:593</a></div></div>
<div class="ttc" id="classprodutil_1_1fileop_1_1FileWaiter_html_a7bd23049dd8fadf1173debe9a5efa3c2"><div class="ttname"><a href="classprodutil_1_1fileop_1_1FileWaiter.html#a7bd23049dd8fadf1173debe9a5efa3c2">produtil.fileop.FileWaiter.min_ctime_age</a></div><div class="ttdeci">min_ctime_age</div><div class="ttdoc">Minimum age of the creation and/or inode access time. </div><div class="ttdef"><b>Definition:</b> <a href="fileop_8py_source.html#l01008">fileop.py:1008</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
